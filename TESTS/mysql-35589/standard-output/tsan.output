==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x00000229e268 by thread T2:
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97:8 (mysqld+0x0000010122b3)
    #1 process_alarm /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_alarm.c:324:3 (mysqld+0x0000010076bf)
    #2 signal_hand /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:2799:7 (mysqld+0x000000823fd9)

  Previous write of size 8 at 0x00000229e268 by thread T3 (mutexes: write M570, write M569):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:166:3 (mysqld+0x0000010128c2)
    #1 thr_alarm /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_alarm.c:167:3 (mysqld+0x0000010078cc)
    #2 my_real_read(st_net*, unsigned long*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/net_serv.cc:829:11 (mysqld+0x0000007feba8)
    #3 my_net_read /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/net_serv.cc:996:11 (mysqld+0x0000007fd2db)
    #4 check_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:753:12 (mysqld+0x000000843472)
    #5 login_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:955:10 (mysqld+0x00000084131d)
    #6 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1107:9 (mysqld+0x000000840f43)

  Location is global 'LOCK_alarm' of size 104 at 0x00000229e218 (mysqld+0x00000229e268)

  Mutex M570 (0x00000229e240) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thr_alarm /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_alarm.c:78:3 (mysqld+0x000001006f28)
    #3 signal_hand /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:2686:3 (mysqld+0x0000008238be)

  Mutex M569 (0x00000229e218) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:60:3 (mysqld+0x0000010120e7)
    #2 init_thr_alarm /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_alarm.c:78:3 (mysqld+0x000001006f28)
    #3 signal_hand /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:2686:3 (mysqld+0x0000008238be)

  Thread T2 (tid=11696, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 start_signal_handler() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:2657:14 (mysqld+0x00000082b424)
    #2 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4380:3 (mysqld+0x00000082513e)

  Thread T3 (tid=11705, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97 safe_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x00000229fe68 by thread T4:
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97:8 (mysqld+0x0000010122b3)
    #1 my_thread_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_thr_init.c:294:3 (mysqld+0x00000101487c)
    #2 init_new_connection_handler_thread() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:618:7 (mysqld+0x000000840ab5)
    #3 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1080:7 (mysqld+0x000000840d3a)

  Previous write of size 8 at 0x00000229fe68 by thread T3 (mutexes: write M446, write M445):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:166:3 (mysqld+0x0000010128c2)
    #1 my_thread_end /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_thr_init.c:357:5 (mysqld+0x00000101504d)
    #2 one_thread_per_connection_end(THD*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:1919:3 (mysqld+0x00000082258e)
    #3 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1122:9 (mysqld+0x0000008410e5)

  Location is global 'THR_LOCK_threads' of size 104 at 0x00000229fe18 (mysqld+0x00000229fe68)

  Mutex M446 (0x00000229fe40) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 my_thread_global_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_thr_init.c:149:3 (mysqld+0x0000010144f2)
    #3 my_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_init.c:81:7 (mysqld+0x000000f6fb5f)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4215:3 (mysqld+0x000000824ba3)

  Mutex M445 (0x00000229fe18) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:60:3 (mysqld+0x0000010120e7)
    #2 my_thread_global_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_thr_init.c:149:3 (mysqld+0x0000010144f2)
    #3 my_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_init.c:81:7 (mysqld+0x000000f6fb5f)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4215:3 (mysqld+0x000000824ba3)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T3 (tid=11705, finished) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97 safe_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x00000228fe00 by thread T4:
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97:8 (mysqld+0x0000010122b3)
    #1 check_user(THD*, enum_server_command, char const*, unsigned int, char const*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:327:3 (mysqld+0x00000083d847)
    #2 check_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:897:10 (mysqld+0x000000844b9d)
    #3 login_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:955:10 (mysqld+0x00000084131d)
    #4 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1107:9 (mysqld+0x000000840f43)

  Previous write of size 8 at 0x00000228fe00 by main thread (mutexes: write M495, write M494):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:166:3 (mysqld+0x0000010128c2)
    #1 THD::init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_class.cc:755:3 (mysqld+0x0000007d9c22)
    #2 THD::THD() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_class.cc:638:3 (mysqld+0x0000007d94ae)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5102:16 (mysqld+0x00000082c6e9)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Location is global 'LOCK_global_system_variables' of size 104 at 0x00000228fdb0 (mysqld+0x00000228fe00)

  Mutex M495 (0x00000228fdd8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3520:10 (mysqld+0x000000832e42)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M494 (0x00000228fdb0) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:60:3 (mysqld+0x0000010120e7)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3520:10 (mysqld+0x000000832e42)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97 safe_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x00000228ffa0 by thread T4:
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97:8 (mysqld+0x0000010122b3)
    #1 check_user(THD*, enum_server_command, char const*, unsigned int, char const*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:405:9 (mysqld+0x00000083e1c5)
    #2 check_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:897:10 (mysqld+0x000000844b9d)
    #3 login_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:955:10 (mysqld+0x00000084131d)
    #4 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1107:9 (mysqld+0x000000840f43)

  Previous write of size 8 at 0x00000228ffa0 by main thread (mutexes: write M504, write M503):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:166:3 (mysqld+0x0000010128c2)
    #1 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4869:3 (mysqld+0x00000082d350)
    #2 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Location is global 'LOCK_connection_count' of size 104 at 0x00000228ff50 (mysqld+0x00000228ffa0)

  Mutex M504 (0x00000228ff78) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3525:10 (mysqld+0x000000832f04)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M503 (0x00000228ff50) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:60:3 (mysqld+0x0000010120e7)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3525:10 (mysqld+0x000000832f04)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97 safe_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x00000229ff00 by thread T5:
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97:8 (mysqld+0x0000010122b3)
    #1 my_inet_ntoa /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_net.c:38:3 (mysqld+0x000000fe96d0)
    #2 vio_peer_addr /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/vio/viosocket.c:328:5 (mysqld+0x000000f6f445)
    #3 check_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:655:9 (mysqld+0x000000842279)
    #4 login_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:955:10 (mysqld+0x00000084131d)
    #5 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1107:9 (mysqld+0x000000840f43)

  Previous write of size 8 at 0x00000229ff00 by thread T4 (mutexes: write M442, write M441):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:166:3 (mysqld+0x0000010128c2)
    #1 my_inet_ntoa /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_net.c:38:3 (mysqld+0x000000fe96d0)
    #2 vio_peer_addr /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/vio/viosocket.c:328:5 (mysqld+0x000000f6f445)
    #3 check_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:655:9 (mysqld+0x000000842279)
    #4 login_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:955:10 (mysqld+0x00000084131d)
    #5 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1107:9 (mysqld+0x000000840f43)

  Location is global 'THR_LOCK_net' of size 104 at 0x00000229feb0 (mysqld+0x00000229ff00)

  Mutex M442 (0x00000229fed8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 my_thread_global_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_thr_init.c:147:3 (mysqld+0x000001014496)
    #3 my_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_init.c:81:7 (mysqld+0x000000f6fb5f)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4215:3 (mysqld+0x000000824ba3)

  Mutex M441 (0x00000229feb0) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:60:3 (mysqld+0x0000010120e7)
    #2 my_thread_global_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_thr_init.c:147:3 (mysqld+0x000001014496)
    #3 my_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_init.c:81:7 (mysqld+0x000000f6fb5f)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4215:3 (mysqld+0x000000824ba3)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97 safe_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x7d4000007590 by thread T5:
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97:8 (mysqld+0x0000010122b3)
    #1 acl_check_host(char const*, char const*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:1487:3 (mysqld+0x000000aa6b11)
    #2 check_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:688:9 (mysqld+0x000000842ad2)
    #3 login_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:955:10 (mysqld+0x00000084131d)
    #4 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1107:9 (mysqld+0x000000840f43)

  Previous write of size 8 at 0x7d4000007590 by thread T4 (mutexes: write M603, write M602):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:166:3 (mysqld+0x0000010128c2)
    #1 acl_getroot(THD*, user_resources*, char const*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:889:3 (mysqld+0x000000aa4158)
    #2 check_user(THD*, enum_server_command, char const*, unsigned int, char const*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:350:12 (mysqld+0x00000083da9b)
    #3 check_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:897:10 (mysqld+0x000000844b9d)
    #4 login_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:955:10 (mysqld+0x00000084131d)
    #5 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1107:9 (mysqld+0x000000840f43)

  Location is heap block of size 256 at 0x7d4000007500 allocated by main thread:
    #0 operator new(unsigned long) /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:571 (mysqld+0x0000005390df)
    #1 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:263:14 (mysqld+0x000000a9f16e)
    #2 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M602 (0x7d4000007540) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:60:3 (mysqld+0x0000010120e7)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97 safe_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x00000228f920 by thread T4:
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97:8 (mysqld+0x0000010122b3)
    #1 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:972:3 (mysqld+0x000000846cb1)
    #2 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #3 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x00000228f920 by main thread (mutexes: write M469, write M468):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:166:3 (mysqld+0x0000010128c2)
    #1 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4890:3 (mysqld+0x00000082d57a)
    #2 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Location is global 'LOCK_thread_count' of size 104 at 0x00000228f8d0 (mysqld+0x00000228f920)

  Mutex M469 (0x00000228f8f8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3507:10 (mysqld+0x000000832c1f)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M468 (0x00000228f8d0) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:60:3 (mysqld+0x0000010120e7)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3507:10 (mysqld+0x000000832c1f)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97 safe_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x000002290a78 by thread T6:
    #0 check_stack_overrun(THD*, long, unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5564:19 (mysqld+0x00000087151b)
    #1 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2527:7 (mysqld+0x0000009337d9)
    #2 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #3 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #4 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #5 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #6 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #7 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #8 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #9 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #10 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #11 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x000002290a78 by thread T4:
    #0 check_stack_overrun(THD*, long, unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5564:3 (mysqld+0x0000008715a4)
    #1 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2527:7 (mysqld+0x0000009337d9)
    #2 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #3 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #4 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #5 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #6 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #7 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #8 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #9 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #10 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #11 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'max_stack_used' of size 8 at 0x000002290a78 (mysqld+0x000002290a78)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5564 check_stack_overrun(THD*, long, unsigned char*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x7d80000054b0 by thread T5 (mutexes: write M467, write M438):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97:8 (mysqld+0x0000010122b3)
    #1 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:614:3 (mysqld+0x000000e3e8f3)
    #2 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #3 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #4 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #5 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #6 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #7 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #8 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #9 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #10 mysql_table_grant(THD*, TABLE_LIST*, List<st_lex_user>&, List<LEX_COLUMN>&, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3061:7 (mysqld+0x000000aad4e5)
    #11 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3894:14 (mysqld+0x000000861408)
    #12 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #13 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #14 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #15 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x7d80000054b0 by thread T4 (mutexes: write M590, write M589):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:166:3 (mysqld+0x0000010128c2)
    #1 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:52:3 (mysqld+0x000000e7cc61)
    #2 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #3 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #4 unlock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:786:20 (mysqld+0x00000080f565)
    #5 mysql_unlock_tables(THD*, st_mysql_lock*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:391:5 (mysqld+0x00000080f8b0)
    #6 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1336:5 (mysqld+0x0000009296b3)
    #7 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5743:3 (mysqld+0x000000ac8351)
    #8 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #9 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #10 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #11 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #12 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 3792 at 0x7d8000005000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M438 (0x00000229fdd8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 my_thread_global_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_thr_init.c:145:3 (mysqld+0x00000101443a)
    #3 my_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_init.c:81:7 (mysqld+0x000000f6fb5f)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4215:3 (mysqld+0x000000824ba3)

  Mutex M590 (0x7d8000005488) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #12 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M589 (0x7d8000005460) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:60:3 (mysqld+0x0000010120e7)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #12 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97 safe_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 4 at 0x00000228f8c4 by thread T4:
    #0 close_open_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1188:3 (mysqld+0x000000929ce0)
    #1 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1347:5 (mysqld+0x00000092974f)
    #2 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5743:3 (mysqld+0x000000ac8351)
    #3 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #4 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #5 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #6 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #7 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 4 at 0x00000228f8c4 by thread T5 (mutexes: write M467, write M466):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:159:7 (mysqld+0x0000010127cd)
    #1 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2705:3 (mysqld+0x000000934abd)
    #2 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #3 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #4 open_and_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1555:10 (mysqld+0x00000087bf45)
    #5 mysql_table_grant(THD*, TABLE_LIST*, List<st_lex_user>&, List<LEX_COLUMN>&, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2963:11 (mysqld+0x000000aac826)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3894:14 (mysqld+0x000000861408)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'LOCK_open' of size 104 at 0x00000228f868 (mysqld+0x00000228f8c4)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M466 (0x00000228f868) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:60:3 (mysqld+0x0000010120e7)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1188 close_open_tables(THD*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x00000228f8c8 by thread T4:
    #0 close_open_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1188:3 (mysqld+0x000000929d13)
    #1 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1347:5 (mysqld+0x00000092974f)
    #2 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5743:3 (mysqld+0x000000ac8351)
    #3 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #4 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #5 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #6 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #7 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x00000228f8c8 by thread T5 (mutexes: write M467, write M466):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:158:3 (mysqld+0x00000101277b)
    #1 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2705:3 (mysqld+0x000000934abd)
    #2 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #3 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #4 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #5 mysql_table_grant(THD*, TABLE_LIST*, List<st_lex_user>&, List<LEX_COLUMN>&, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3061:7 (mysqld+0x000000aad4e5)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3894:14 (mysqld+0x000000861408)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'LOCK_open' of size 104 at 0x00000228f868 (mysqld+0x00000228f8c8)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M466 (0x00000228f868) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:60:3 (mysqld+0x0000010120e7)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1188 close_open_tables(THD*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x00000228f8b8 by thread T4:
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97:8 (mysqld+0x0000010122b3)
    #1 close_open_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1190:3 (mysqld+0x000000929d7c)
    #2 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1347:5 (mysqld+0x00000092974f)
    #3 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5743:3 (mysqld+0x000000ac8351)
    #4 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #5 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x00000228f8b8 by thread T5 (mutexes: write M467, write M466):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:166:3 (mysqld+0x0000010128c2)
    #1 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2705:3 (mysqld+0x000000934abd)
    #2 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #3 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #4 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #5 mysql_table_grant(THD*, TABLE_LIST*, List<st_lex_user>&, List<LEX_COLUMN>&, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3061:7 (mysqld+0x000000aad4e5)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3894:14 (mysqld+0x000000861408)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'LOCK_open' of size 104 at 0x00000228f868 (mysqld+0x00000228f8b8)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M466 (0x00000228f868) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:60:3 (mysqld+0x0000010120e7)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97 safe_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 4 at 0x7d6000003ac8 by thread T6 (mutexes: write M467, write M660):
    #0 get_table_share(THD*, TABLE_LIST*, char*, unsigned int, unsigned int, int*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:411:8 (mysqld+0x000000922ccf)
    #1 get_table_share_with_create(THD*, TABLE_LIST*, char*, unsigned int, unsigned int, int*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:456:10 (mysqld+0x0000009586d7)
    #2 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3837:16 (mysqld+0x000000931268)
    #3 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #4 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #5 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #6 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #7 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #8 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 4 at 0x7d6000003ac8 by thread T5:
    #0 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2944:3 (mysqld+0x00000093617e)
    #1 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #2 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #3 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #4 mysql_table_grant(THD*, TABLE_LIST*, List<st_lex_user>&, List<LEX_COLUMN>&, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3061:7 (mysqld+0x000000aad4e5)
    #5 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3894:14 (mysqld+0x000000861408)
    #6 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #7 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #8 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #9 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 992 at 0x7d6000003800 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 alloc_root /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_alloc.c:201:30 (mysqld+0x000000fa2998)
    #3 multi_alloc_root /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_alloc.c:264:24 (mysqld+0x000000fa3417)
    #4 alloc_table_share(TABLE_LIST*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:284:7 (mysqld+0x00000095d8e5)
    #5 get_table_share(THD*, TABLE_LIST*, char*, unsigned int, unsigned int, int*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:346:16 (mysqld+0x00000092269d)
    #6 get_table_share_with_create(THD*, TABLE_LIST*, char*, unsigned int, unsigned int, int*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:456:10 (mysqld+0x0000009586d7)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3837:16 (mysqld+0x000000931268)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M660 (0x7d6000003918) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 alloc_table_share(TABLE_LIST*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:320:5 (mysqld+0x00000095dcf0)
    #3 get_table_share(THD*, TABLE_LIST*, char*, unsigned int, unsigned int, int*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:346:16 (mysqld+0x00000092269d)
    #4 get_table_share_with_create(THD*, TABLE_LIST*, char*, unsigned int, unsigned int, int*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:456:10 (mysqld+0x0000009586d7)
    #5 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3837:16 (mysqld+0x000000931268)
    #6 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #7 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #8 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #9 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #10 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #11 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #12 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:411 get_table_share(THD*, TABLE_LIST*, char*, unsigned int, unsigned int, int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x7d74000194b0 by thread T6 (mutexes: write M467, write M438):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97:8 (mysqld+0x0000010122b3)
    #1 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:614:3 (mysqld+0x000000e3e8f3)
    #2 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #3 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #4 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #5 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #6 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #7 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #8 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #9 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #10 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #11 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #12 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #13 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #14 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #15 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #16 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x7d74000194b0 by thread T5 (mutexes: write M664, write M663):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:166:3 (mysqld+0x0000010128c2)
    #1 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:52:3 (mysqld+0x000000e7cc61)
    #2 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #3 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #4 lock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:364:18 (mysqld+0x00000080f009)
    #5 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:260:34 (mysqld+0x00000080cb2d)
    #6 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #7 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #8 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #9 mysql_table_grant(THD*, TABLE_LIST*, List<st_lex_user>&, List<LEX_COLUMN>&, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3061:7 (mysqld+0x000000aad4e5)
    #10 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3894:14 (mysqld+0x000000861408)
    #11 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #12 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #13 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #14 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2400 at 0x7d7400019000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M438 (0x00000229fdd8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 my_thread_global_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_thr_init.c:145:3 (mysqld+0x00000101443a)
    #3 my_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_init.c:81:7 (mysqld+0x000000f6fb5f)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4215:3 (mysqld+0x000000824ba3)

  Mutex M664 (0x7d7400019488) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #12 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M663 (0x7d7400019460) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:60:3 (mysqld+0x0000010120e7)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #12 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97 safe_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 1 at 0x00000228d84e by thread T5 (mutexes: write M507, write M603):
    #0 replace_user_table(THD*, st_table*, st_lex_user const&, unsigned long, bool, bool, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2049:5 (mysqld+0x000000ab1cf4)
    #1 mysql_table_grant(THD*, TABLE_LIST*, List<st_lex_user>&, List<LEX_COLUMN>&, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3086:11 (mysqld+0x000000aad8ab)
    #2 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3894:14 (mysqld+0x000000861408)
    #3 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #4 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #5 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #6 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 1 at 0x00000228d84e by thread T4:
    #0 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5899:11 (mysqld+0x00000084ccf1)
    #1 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #2 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #3 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'mqh_used' of size 1 at 0x00000228d84e (mysqld+0x00000228d84e)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2049 replace_user_table(THD*, st_table*, st_lex_user const&, unsigned long, bool, bool, bool)
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 1 at 0x7d800000535e by thread T6:
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:34:3 (mysqld+0x000000e7c953)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 lock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:364:18 (mysqld+0x00000080f009)
    #4 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:260:34 (mysqld+0x00000080cb2d)
    #5 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #6 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #7 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #8 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #9 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #10 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #11 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #12 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #13 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #14 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 1 at 0x7d800000535e by thread T5 (mutexes: write M507, write M603):
    #0 _mi_mark_file_changed /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:535:7 (mysqld+0x000000e81104)
    #1 mi_write /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_write.c:86:7 (mysqld+0x000000eb0390)
    #2 ha_myisam::write_row(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:772:10 (mysqld+0x000000e2a97c)
    #3 handler::ha_write_row(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4591:7 (mysqld+0x000000bc9747)
    #4 replace_user_table(THD*, st_table*, st_lex_user const&, unsigned long, bool, bool, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2071:19 (mysqld+0x000000ab2019)
    #5 mysql_table_grant(THD*, TABLE_LIST*, List<st_lex_user>&, List<LEX_COLUMN>&, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3086:11 (mysqld+0x000000aad8ab)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3894:14 (mysqld+0x000000861408)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 3792 at 0x7d8000005000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:34 mi_lock_database
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 4 at 0x7d80000050ec by thread T6:
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:34:3 (mysqld+0x000000e7c98f)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 lock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:364:18 (mysqld+0x00000080f009)
    #4 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:260:34 (mysqld+0x00000080cb2d)
    #5 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #6 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #7 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #8 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #9 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #10 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #11 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #12 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #13 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #14 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 4 at 0x7d80000050ec by thread T5 (mutexes: write M507, write M603):
    #0 _mi_mark_file_changed /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:536:7 (mysqld+0x000000e8114a)
    #1 mi_write /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_write.c:86:7 (mysqld+0x000000eb0390)
    #2 ha_myisam::write_row(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:772:10 (mysqld+0x000000e2a97c)
    #3 handler::ha_write_row(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4591:7 (mysqld+0x000000bc9747)
    #4 replace_user_table(THD*, st_table*, st_lex_user const&, unsigned long, bool, bool, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2071:19 (mysqld+0x000000ab2019)
    #5 mysql_table_grant(THD*, TABLE_LIST*, List<st_lex_user>&, List<LEX_COLUMN>&, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3086:11 (mysqld+0x000000aad8ab)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3894:14 (mysqld+0x000000861408)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 3792 at 0x7d8000005000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:34 mi_lock_database
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 4 at 0x7d8000005354 by thread T5 (mutexes: write M507, write M603):
    #0 _mi_write_part_record /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_dynrec.c:753:24 (mysqld+0x000000ea0c3c)
    #1 write_dynamic_record /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_dynrec.c:356:9 (mysqld+0x000000e998b5)
    #2 _mi_write_blob_record /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_dynrec.c:273:9 (mysqld+0x000000e9b92d)
    #3 mi_write /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_write.c:146:11 (mysqld+0x000000eb0fd2)
    #4 ha_myisam::write_row(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:772:10 (mysqld+0x000000e2a97c)
    #5 handler::ha_write_row(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4591:7 (mysqld+0x000000bc9747)
    #6 replace_user_table(THD*, st_table*, st_lex_user const&, unsigned long, bool, bool, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2071:19 (mysqld+0x000000ab2019)
    #7 mysql_table_grant(THD*, TABLE_LIST*, List<st_lex_user>&, List<LEX_COLUMN>&, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3086:11 (mysqld+0x000000aad8ab)
    #8 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3894:14 (mysqld+0x000000861408)
    #9 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #10 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #11 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #12 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 4 at 0x7d8000005354 by thread T4 (mutexes: write M467, write M438, write M590):
    #0 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:617:3 (mysqld+0x000000e3e9da)
    #1 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #2 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #3 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #4 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #5 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #6 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #7 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #8 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #9 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #10 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #11 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #12 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #13 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #14 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #15 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 3792 at 0x7d8000005000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M438 (0x00000229fdd8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 my_thread_global_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_thr_init.c:145:3 (mysqld+0x00000101443a)
    #3 my_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_init.c:81:7 (mysqld+0x000000f6fb5f)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4215:3 (mysqld+0x000000824ba3)

  Mutex M590 (0x7d8000005488) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #12 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_dynrec.c:753 _mi_write_part_record
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 4 at 0x7d800000534c by thread T6 (mutexes: write M590):
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:233:7 (mysqld+0x000000e7ec3b)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 lock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:364:18 (mysqld+0x00000080f009)
    #4 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:260:34 (mysqld+0x00000080cb2d)
    #5 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #6 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #7 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #8 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #9 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #10 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #11 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #12 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #13 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #14 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 4 at 0x7d800000534c by thread T5 (mutexes: write M507, write M603):
    #0 _mi_read_dynamic_record /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_dynrec.c:1511:3 (mysqld+0x000000ea9c8a)
    #1 mi_rkey /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_rkey.c:173:10 (mysqld+0x000000e58e9f)
    #2 ha_myisam::index_read_idx_map(unsigned char*, unsigned int, unsigned char const*, unsigned long, ha_rkey_function) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1671:13 (mysqld+0x000000e32c6a)
    #3 replace_user_table(THD*, st_table*, st_lex_user const&, unsigned long, bool, bool, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:1922:7 (mysqld+0x000000aaf749)
    #4 mysql_table_grant(THD*, TABLE_LIST*, List<st_lex_user>&, List<LEX_COLUMN>&, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3086:11 (mysqld+0x000000aad8ab)
    #5 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3894:14 (mysqld+0x000000861408)
    #6 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #7 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #8 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #9 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 3792 at 0x7d8000005000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M590 (0x7d8000005488) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #12 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:233 mi_lock_database
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 4 at 0x7d6000001ec8 by thread T4 (mutexes: write M467, write M668):
    #0 get_table_share(THD*, TABLE_LIST*, char*, unsigned int, unsigned int, int*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:411:8 (mysqld+0x000000922ccf)
    #1 get_table_share_with_create(THD*, TABLE_LIST*, char*, unsigned int, unsigned int, int*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:456:10 (mysqld+0x0000009586d7)
    #2 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3837:16 (mysqld+0x000000931268)
    #3 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #4 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #5 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #6 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #7 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #8 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 4 at 0x7d6000001ec8 by thread T6:
    #0 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2944:3 (mysqld+0x00000093617e)
    #1 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #2 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #3 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #4 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #5 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 992 at 0x7d6000001c00 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 alloc_root /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_alloc.c:201:30 (mysqld+0x000000fa2998)
    #3 multi_alloc_root /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_alloc.c:264:24 (mysqld+0x000000fa3417)
    #4 alloc_table_share(TABLE_LIST*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:284:7 (mysqld+0x00000095d8e5)
    #5 get_table_share(THD*, TABLE_LIST*, char*, unsigned int, unsigned int, int*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:346:16 (mysqld+0x00000092269d)
    #6 get_table_share_with_create(THD*, TABLE_LIST*, char*, unsigned int, unsigned int, int*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:456:10 (mysqld+0x0000009586d7)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3837:16 (mysqld+0x000000931268)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3726:7 (mysqld+0x000000abcb48)
    #13 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #14 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #15 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M668 (0x7d6000001d18) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 alloc_table_share(TABLE_LIST*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:320:5 (mysqld+0x00000095dcf0)
    #3 get_table_share(THD*, TABLE_LIST*, char*, unsigned int, unsigned int, int*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:346:16 (mysqld+0x00000092269d)
    #4 get_table_share_with_create(THD*, TABLE_LIST*, char*, unsigned int, unsigned int, int*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:456:10 (mysqld+0x0000009586d7)
    #5 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3837:16 (mysqld+0x000000931268)
    #6 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #7 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #8 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #9 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #10 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3726:7 (mysqld+0x000000abcb48)
    #11 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #12 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:411 get_table_share(THD*, TABLE_LIST*, char*, unsigned int, unsigned int, int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x7d7c0000e4b0 by thread T6:
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97:8 (mysqld+0x0000010122b3)
    #1 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:52:3 (mysqld+0x000000e7cc61)
    #2 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #3 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #4 lock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:364:18 (mysqld+0x00000080f009)
    #5 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:260:34 (mysqld+0x00000080cb2d)
    #6 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #7 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #8 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #9 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #10 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #11 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #12 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #13 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #14 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #15 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x7d7c0000e4b0 by thread T4 (mutexes: write M467, write M438, write M598, write M597):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:166:3 (mysqld+0x0000010128c2)
    #1 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:614:3 (mysqld+0x000000e3e8f3)
    #2 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #3 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #4 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #5 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #6 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #7 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #8 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #9 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #10 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #11 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #12 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #13 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #14 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #15 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #16 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 3232 at 0x7d7c0000e000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M438 (0x00000229fdd8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 my_thread_global_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_thr_init.c:145:3 (mysqld+0x00000101443a)
    #3 my_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_init.c:81:7 (mysqld+0x000000f6fb5f)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4215:3 (mysqld+0x000000824ba3)

  Mutex M598 (0x7d7c0000e488) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #12 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M597 (0x7d7c0000e460) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:60:3 (mysqld+0x0000010120e7)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #12 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97 safe_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 4 at 0x7d8000005344 by thread T4:
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:34:3 (mysqld+0x000000e7c918)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 lock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:364:18 (mysqld+0x00000080f009)
    #4 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:260:34 (mysqld+0x00000080cb2d)
    #5 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #6 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #7 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #8 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #9 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #10 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #11 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #12 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #13 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #14 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 4 at 0x7d8000005344 by thread T6 (mutexes: write M590):
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:232:7 (mysqld+0x000000e7ebee)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 lock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:364:18 (mysqld+0x00000080f009)
    #4 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:260:34 (mysqld+0x00000080cb2d)
    #5 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #6 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #7 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #8 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #9 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #10 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #11 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #12 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #13 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #14 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 3792 at 0x7d8000005000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M590 (0x7d8000005488) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #12 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:34 mi_lock_database
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 1 at 0x7d780000e75e by thread T4:
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:34:3 (mysqld+0x000000e7c953)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 lock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:364:18 (mysqld+0x00000080f009)
    #4 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:260:34 (mysqld+0x00000080cb2d)
    #5 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #6 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #7 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #8 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #9 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #10 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #11 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #12 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #13 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #14 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 1 at 0x7d780000e75e by thread T5 (mutexes: write M507, write M603):
    #0 _mi_mark_file_changed /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:535:7 (mysqld+0x000000e81104)
    #1 mi_write /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_write.c:86:7 (mysqld+0x000000eb0390)
    #2 ha_myisam::write_row(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:772:10 (mysqld+0x000000e2a97c)
    #3 handler::ha_write_row(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4591:7 (mysqld+0x000000bc9747)
    #4 replace_table_table(THD*, GRANT_TABLE*, st_table*, st_lex_user const&, char const*, char const*, unsigned long, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2769:11 (mysqld+0x000000ab3ea6)
    #5 mysql_table_grant(THD*, TABLE_LIST*, List<st_lex_user>&, List<LEX_COLUMN>&, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3157:9 (mysqld+0x000000aae2a8)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3894:14 (mysqld+0x000000861408)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2632 at 0x7d780000e400 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:34 mi_lock_database
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 4 at 0x7d780000e4ec by thread T5 (mutexes: write M507, write M603):
    #0 _mi_mark_file_changed /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:536:7 (mysqld+0x000000e8114a)
    #1 mi_write /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_write.c:86:7 (mysqld+0x000000eb0390)
    #2 ha_myisam::write_row(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:772:10 (mysqld+0x000000e2a97c)
    #3 handler::ha_write_row(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4591:7 (mysqld+0x000000bc9747)
    #4 replace_table_table(THD*, GRANT_TABLE*, st_table*, st_lex_user const&, char const*, char const*, unsigned long, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2769:11 (mysqld+0x000000ab3ea6)
    #5 mysql_table_grant(THD*, TABLE_LIST*, List<st_lex_user>&, List<LEX_COLUMN>&, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3157:9 (mysqld+0x000000aae2a8)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3894:14 (mysqld+0x000000861408)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 4 at 0x7d780000e4ec by thread T6:
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:34:3 (mysqld+0x000000e7c98f)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 lock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:364:18 (mysqld+0x00000080f009)
    #4 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:260:34 (mysqld+0x00000080cb2d)
    #5 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #6 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #7 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #8 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #9 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #10 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #11 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #12 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #13 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #14 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2632 at 0x7d780000e400 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:536 _mi_mark_file_changed
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 4 at 0x7d780000e74c by thread T4 (mutexes: write M655):
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:233:7 (mysqld+0x000000e7ec3b)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 lock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:364:18 (mysqld+0x00000080f009)
    #4 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:260:34 (mysqld+0x00000080cb2d)
    #5 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #6 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #7 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #8 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #9 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #10 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #11 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #12 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #13 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #14 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 4 at 0x7d780000e74c by thread T5 (mutexes: write M507, write M603):
    #0 _mi_read_static_record /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_statrec.c:196:3 (mysqld+0x000000e84a0d)
    #1 mi_rkey /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_rkey.c:173:10 (mysqld+0x000000e58e9f)
    #2 ha_myisam::index_read_idx_map(unsigned char*, unsigned int, unsigned char const*, unsigned long, ha_rkey_function) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1671:13 (mysqld+0x000000e32c6a)
    #3 replace_table_table(THD*, GRANT_TABLE*, st_table*, st_lex_user const&, char const*, char const*, unsigned long, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2708:7 (mysqld+0x000000ab3266)
    #4 mysql_table_grant(THD*, TABLE_LIST*, List<st_lex_user>&, List<LEX_COLUMN>&, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3157:9 (mysqld+0x000000aae2a8)
    #5 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3894:14 (mysqld+0x000000861408)
    #6 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #7 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #8 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #9 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2632 at 0x7d780000e400 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M655 (0x7d780000e888) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #12 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:233 mi_lock_database
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 4 at 0x7d780000e754 by thread T5 (mutexes: write M507, write M603):
    #0 _mi_write_static_record /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_statrec.c:67:7 (mysqld+0x000000e830ae)
    #1 mi_write /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_write.c:146:11 (mysqld+0x000000eb0fd2)
    #2 ha_myisam::write_row(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:772:10 (mysqld+0x000000e2a97c)
    #3 handler::ha_write_row(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4591:7 (mysqld+0x000000bc9747)
    #4 replace_table_table(THD*, GRANT_TABLE*, st_table*, st_lex_user const&, char const*, char const*, unsigned long, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2769:11 (mysqld+0x000000ab3ea6)
    #5 mysql_table_grant(THD*, TABLE_LIST*, List<st_lex_user>&, List<LEX_COLUMN>&, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3157:9 (mysqld+0x000000aae2a8)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3894:14 (mysqld+0x000000861408)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 4 at 0x7d780000e754 by thread T4 (mutexes: write M467, write M438, write M655):
    #0 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:617:3 (mysqld+0x000000e3e9da)
    #1 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #2 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #3 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #4 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #5 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #6 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #7 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #8 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #9 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #10 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #11 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #12 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #13 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #14 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #15 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2632 at 0x7d780000e400 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M438 (0x00000229fdd8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 my_thread_global_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_thr_init.c:145:3 (mysqld+0x00000101443a)
    #3 my_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_init.c:81:7 (mysqld+0x000000f6fb5f)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4215:3 (mysqld+0x000000824ba3)

  Mutex M655 (0x7d780000e888) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #12 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_statrec.c:67 _mi_write_static_record
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x7d74000193d0 by thread T4:
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97:8 (mysqld+0x0000010122b3)
    #1 thr_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:503:3 (mysqld+0x000001009b7f)
    #2 thr_multi_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:973:39 (mysqld+0x00000100e20f)
    #3 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:276:39 (mysqld+0x00000080ce67)
    #4 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #5 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #6 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #7 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #8 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x7d74000193d0 by thread T5 (mutexes: write M662, write M661):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:166:3 (mysqld+0x0000010128c2)
    #1 thr_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:503:3 (mysqld+0x000001009b7f)
    #2 thr_multi_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:973:39 (mysqld+0x00000100e20f)
    #3 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:276:39 (mysqld+0x00000080ce67)
    #4 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #5 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #6 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #7 mysql_table_grant(THD*, TABLE_LIST*, List<st_lex_user>&, List<LEX_COLUMN>&, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3061:7 (mysqld+0x000000aad4e5)
    #8 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3894:14 (mysqld+0x000000861408)
    #9 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #10 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #11 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #12 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2400 at 0x7d7400019000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M662 (0x7d74000193a8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M661 (0x7d7400019380) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:60:3 (mysqld+0x0000010120e7)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97 safe_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 4 at 0x7d740001934c by thread T5 (mutexes: write M507, write M603):
    #0 _mi_read_static_record /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_statrec.c:196:3 (mysqld+0x000000e84a0d)
    #1 mi_rkey /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_rkey.c:173:10 (mysqld+0x000000e58e9f)
    #2 ha_myisam::index_read_map(unsigned char*, unsigned char const*, unsigned long, ha_rkey_function) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1661:13 (mysqld+0x000000e32a4e)
    #3 replace_column_table(GRANT_TABLE*, st_table*, st_lex_user const&, List<LEX_COLUMN>&, char const*, char const*, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2527:9 (mysqld+0x000000ab4e67)
    #4 mysql_table_grant(THD*, TABLE_LIST*, List<st_lex_user>&, List<LEX_COLUMN>&, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3166:12 (mysqld+0x000000aae410)
    #5 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3894:14 (mysqld+0x000000861408)
    #6 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #7 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #8 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #9 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 4 at 0x7d740001934c by thread T6 (mutexes: write M664):
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:233:7 (mysqld+0x000000e7ec3b)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 lock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:364:18 (mysqld+0x00000080f009)
    #4 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:260:34 (mysqld+0x00000080cb2d)
    #5 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #6 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #7 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #8 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #9 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #10 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #11 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #12 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #13 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #14 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2400 at 0x7d7400019000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M664 (0x7d7400019488) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #12 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_statrec.c:196 _mi_read_static_record
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 1 at 0x7d740001935e by thread T5 (mutexes: write M507, write M603):
    #0 _mi_mark_file_changed /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:535:7 (mysqld+0x000000e81104)
    #1 mi_write /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_write.c:86:7 (mysqld+0x000000eb0390)
    #2 ha_myisam::write_row(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:772:10 (mysqld+0x000000e2a97c)
    #3 handler::ha_write_row(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4591:7 (mysqld+0x000000bc9747)
    #4 replace_column_table(GRANT_TABLE*, st_table*, st_lex_user const&, List<LEX_COLUMN>&, char const*, char const*, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2583:18 (mysqld+0x000000ab5986)
    #5 mysql_table_grant(THD*, TABLE_LIST*, List<st_lex_user>&, List<LEX_COLUMN>&, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3166:12 (mysqld+0x000000aae410)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3894:14 (mysqld+0x000000861408)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 1 at 0x7d740001935e by thread T4:
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:34:3 (mysqld+0x000000e7c953)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 lock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:364:18 (mysqld+0x00000080f009)
    #4 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:260:34 (mysqld+0x00000080cb2d)
    #5 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #6 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #7 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #8 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #9 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #10 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #11 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #12 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #13 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #14 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2400 at 0x7d7400019000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:535 _mi_mark_file_changed
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 4 at 0x7d74000190ec by thread T5 (mutexes: write M507, write M603):
    #0 _mi_mark_file_changed /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:536:7 (mysqld+0x000000e8114a)
    #1 mi_write /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_write.c:86:7 (mysqld+0x000000eb0390)
    #2 ha_myisam::write_row(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:772:10 (mysqld+0x000000e2a97c)
    #3 handler::ha_write_row(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4591:7 (mysqld+0x000000bc9747)
    #4 replace_column_table(GRANT_TABLE*, st_table*, st_lex_user const&, List<LEX_COLUMN>&, char const*, char const*, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2583:18 (mysqld+0x000000ab5986)
    #5 mysql_table_grant(THD*, TABLE_LIST*, List<st_lex_user>&, List<LEX_COLUMN>&, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3166:12 (mysqld+0x000000aae410)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3894:14 (mysqld+0x000000861408)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 4 at 0x7d74000190ec by thread T4:
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:34:3 (mysqld+0x000000e7c98f)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 lock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:364:18 (mysqld+0x00000080f009)
    #4 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:260:34 (mysqld+0x00000080cb2d)
    #5 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #6 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #7 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #8 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #9 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #10 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #11 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #12 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #13 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #14 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2400 at 0x7d7400019000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:536 _mi_mark_file_changed
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 4 at 0x7d7400019354 by thread T5 (mutexes: write M507, write M603):
    #0 _mi_write_static_record /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_statrec.c:67:7 (mysqld+0x000000e830ae)
    #1 mi_write /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_write.c:146:11 (mysqld+0x000000eb0fd2)
    #2 ha_myisam::write_row(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:772:10 (mysqld+0x000000e2a97c)
    #3 handler::ha_write_row(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4591:7 (mysqld+0x000000bc9747)
    #4 replace_column_table(GRANT_TABLE*, st_table*, st_lex_user const&, List<LEX_COLUMN>&, char const*, char const*, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2583:18 (mysqld+0x000000ab5986)
    #5 mysql_table_grant(THD*, TABLE_LIST*, List<st_lex_user>&, List<LEX_COLUMN>&, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3166:12 (mysqld+0x000000aae410)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3894:14 (mysqld+0x000000861408)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 4 at 0x7d7400019354 by thread T4 (mutexes: write M467, write M438, write M664):
    #0 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:617:3 (mysqld+0x000000e3e9da)
    #1 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #2 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #3 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #4 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #5 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #6 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #7 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #8 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #9 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #10 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #11 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #12 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #13 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #14 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #15 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2400 at 0x7d7400019000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M438 (0x00000229fdd8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 my_thread_global_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_thr_init.c:145:3 (mysqld+0x00000101443a)
    #3 my_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_init.c:81:7 (mysqld+0x000000f6fb5f)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4215:3 (mysqld+0x000000824ba3)

  Mutex M664 (0x7d7400019488) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #12 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_statrec.c:67 _mi_write_static_record
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x00000229d260 by thread T5:
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97:8 (mysqld+0x0000010122b3)
    #1 plugin_unlock_list(THD*, st_plugin_int***, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_plugin.cc:986:3 (mysqld+0x000000d913cb)
    #2 lex_end(st_lex*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_lex.cc:378:3 (mysqld+0x000000593fd8)
    #3 THD::end_statement() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_class.cc:2369:3 (mysqld+0x0000007e834b)
    #4 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5948:5 (mysqld+0x00000084d2be)
    #5 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #6 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #7 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x00000229d260 by thread T4 (mutexes: write M554, write M553):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:166:3 (mysqld+0x0000010128c2)
    #1 plugin_unlock_list(THD*, st_plugin_int***, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_plugin.cc:986:3 (mysqld+0x000000d913cb)
    #2 lex_end(st_lex*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_lex.cc:378:3 (mysqld+0x000000593fd8)
    #3 THD::end_statement() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_class.cc:2369:3 (mysqld+0x0000007e834b)
    #4 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5948:5 (mysqld+0x00000084d2be)
    #5 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #6 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #7 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'LOCK_plugin' of size 104 at 0x00000229d210 (mysqld+0x00000229d260)

  Mutex M554 (0x00000229d238) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 plugin_init(int*, char**, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_plugin.cc:1115:3 (mysqld+0x000000d918f0)
    #3 init_server_components() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3882:9 (mysqld+0x000000829ad2)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4354:7 (mysqld+0x0000008250b3)

  Mutex M553 (0x00000229d210) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:60:3 (mysqld+0x0000010120e7)
    #2 plugin_init(int*, char**, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_plugin.cc:1115:3 (mysqld+0x000000d918f0)
    #3 init_server_components() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3882:9 (mysqld+0x000000829ad2)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4354:7 (mysqld+0x0000008250b3)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97 safe_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 8 at 0x7d8000005018 by thread T5 (mutexes: write M588):
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 mi_update_status /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:323:5 (mysqld+0x000000e7fc79)
    #2 thr_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:790:9 (mysqld+0x00000100cbd3)
    #3 thr_multi_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:1050:7 (mysqld+0x00000100f115)
    #4 mysql_unlock_tables(THD*, st_mysql_lock*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:389:5 (mysqld+0x00000080f801)
    #5 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1336:5 (mysqld+0x0000009296b3)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1591:3 (mysqld+0x00000084b629)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x7d8000005018 by thread T4 (mutexes: write M467):
    #0 mi_status /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_info.c:52:20 (mysqld+0x000000e56499)
    #1 ha_myisam::info(unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1779:10 (mysqld+0x000000e33e9c)
    #2 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:717:3 (mysqld+0x000000e29fc2)
    #3 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #4 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #5 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #6 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #7 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #8 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #9 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #10 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #11 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #12 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #13 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #14 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #15 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #16 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 3792 at 0x7d8000005000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M588 (0x7d80000053a8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:323 mi_update_status
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 8 at 0x7d8000005020 by thread T5 (mutexes: write M588):
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 mi_update_status /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:323:5 (mysqld+0x000000e7fc79)
    #2 thr_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:790:9 (mysqld+0x00000100cbd3)
    #3 thr_multi_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:1050:7 (mysqld+0x00000100f115)
    #4 mysql_unlock_tables(THD*, st_mysql_lock*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:389:5 (mysqld+0x00000080f801)
    #5 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1336:5 (mysqld+0x0000009296b3)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1591:3 (mysqld+0x00000084b629)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x7d8000005020 by thread T4 (mutexes: write M467):
    #0 mi_status /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_info.c:53:20 (mysqld+0x000000e56527)
    #1 ha_myisam::info(unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1779:10 (mysqld+0x000000e33e9c)
    #2 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:717:3 (mysqld+0x000000e29fc2)
    #3 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #4 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #5 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #6 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #7 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #8 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #9 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #10 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #11 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #12 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #13 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #14 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #15 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #16 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 3792 at 0x7d8000005000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M588 (0x7d80000053a8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:323 mi_update_status
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 8 at 0x7d8000005028 by thread T5 (mutexes: write M588):
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 mi_update_status /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:323:5 (mysqld+0x000000e7fc79)
    #2 thr_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:790:9 (mysqld+0x00000100cbd3)
    #3 thr_multi_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:1050:7 (mysqld+0x00000100f115)
    #4 mysql_unlock_tables(THD*, st_mysql_lock*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:389:5 (mysqld+0x00000080f801)
    #5 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1336:5 (mysqld+0x0000009296b3)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1591:3 (mysqld+0x00000084b629)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x7d8000005028 by thread T4 (mutexes: write M467):
    #0 mi_status /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_info.c:54:24 (mysqld+0x000000e565be)
    #1 ha_myisam::info(unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1779:10 (mysqld+0x000000e33e9c)
    #2 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:717:3 (mysqld+0x000000e29fc2)
    #3 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #4 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #5 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #6 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #7 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #8 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #9 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #10 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #11 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #12 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #13 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #14 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #15 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #16 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 3792 at 0x7d8000005000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M588 (0x7d80000053a8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:323 mi_update_status
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 8 at 0x7d8000005038 by thread T5 (mutexes: write M588):
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 mi_update_status /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:323:5 (mysqld+0x000000e7fc79)
    #2 thr_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:790:9 (mysqld+0x00000100cbd3)
    #3 thr_multi_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:1050:7 (mysqld+0x00000100f115)
    #4 mysql_unlock_tables(THD*, st_mysql_lock*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:389:5 (mysqld+0x00000080f801)
    #5 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1336:5 (mysqld+0x0000009296b3)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1591:3 (mysqld+0x00000084b629)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x7d8000005038 by thread T4 (mutexes: write M467):
    #0 mi_status /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_info.c:56:26 (mysqld+0x000000e566ec)
    #1 ha_myisam::info(unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1779:10 (mysqld+0x000000e33e9c)
    #2 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:717:3 (mysqld+0x000000e29fc2)
    #3 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #4 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #5 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #6 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #7 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #8 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #9 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #10 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #11 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #12 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #13 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #14 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #15 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #16 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 3792 at 0x7d8000005000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M588 (0x7d80000053a8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:323 mi_update_status
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 8 at 0x7d8000005040 by thread T5 (mutexes: write M588):
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 mi_update_status /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:323:5 (mysqld+0x000000e7fc79)
    #2 thr_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:790:9 (mysqld+0x00000100cbd3)
    #3 thr_multi_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:1050:7 (mysqld+0x00000100f115)
    #4 mysql_unlock_tables(THD*, st_mysql_lock*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:389:5 (mysqld+0x00000080f801)
    #5 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1336:5 (mysqld+0x0000009296b3)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1591:3 (mysqld+0x00000084b629)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x7d8000005040 by thread T4 (mutexes: write M467):
    #0 mi_status /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_info.c:55:26 (mysqld+0x000000e56655)
    #1 ha_myisam::info(unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1779:10 (mysqld+0x000000e33e9c)
    #2 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:717:3 (mysqld+0x000000e29fc2)
    #3 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #4 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #5 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #6 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #7 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #8 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #9 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #10 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #11 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #12 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #13 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #14 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #15 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #16 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 3792 at 0x7d8000005000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M588 (0x7d80000053a8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:323 mi_update_status
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 1 at 0x7d6000006f70 by thread T4 (mutexes: write M507, write M603):
    #0 bitmap_is_set(st_bitmap const*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/../include/my_bitmap.h:141:10 (mysqld+0x00000076c4b5)
    #1 Field_string::val_str(String*, String*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/field.cc:6609:3 (mysqld+0x00000079c02e)
    #2 Field::val_str(String*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./field.h:121:48 (mysqld+0x0000005f4bc3)
    #3 get_field(st_mem_root*, Field*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:2614:3 (mysqld+0x0000009737d0)
    #4 handle_grant_table(TABLE_LIST*, unsigned int, bool, st_lex_user*, st_lex_user*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5251:22 (mysqld+0x000000ad1b69)
    #5 handle_grant_data(TABLE_LIST*, bool, st_lex_user*, st_lex_user*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5552:15 (mysqld+0x000000ac7a8a)
    #6 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5722:9 (mysqld+0x000000ac81a1)
    #7 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #8 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #9 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #10 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #11 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 4 at 0x7d6000006f70 by thread T5 (mutexes: write M467):
    #0 bitmap_is_set_all /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_bitmap.c:299:3 (mysqld+0x000000ff2121)
    #1 handler::ha_reset() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4571:3 (mysqld+0x000000bc94d6)
    #2 close_thread_table(THD*, st_table**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1403:5 (mysqld+0x00000092a595)
    #3 close_open_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1195:23 (mysqld+0x000000929e59)
    #4 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1347:5 (mysqld+0x00000092974f)
    #5 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1591:3 (mysqld+0x00000084b629)
    #6 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #7 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 992 at 0x7d6000006c00 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 alloc_root /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_alloc.c:201:30 (mysqld+0x000000fa2998)
    #3 open_binary_frm(THD*, st_table_share*, unsigned char*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:773:26 (mysqld+0x000000960ea5)
    #4 open_table_def(THD*, st_table_share*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:630:12 (mysqld+0x00000095f4b9)
    #5 get_table_share(THD*, TABLE_LIST*, char*, unsigned int, unsigned int, int*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:377:7 (mysqld+0x000000922803)
    #6 get_table_share_with_create(THD*, TABLE_LIST*, char*, unsigned int, unsigned int, int*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:456:10 (mysqld+0x0000009586d7)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3837:16 (mysqld+0x000000931268)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/../include/my_bitmap.h:141 bitmap_is_set(st_bitmap const*, unsigned int)
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 1 at 0x7d60000033a0 by thread T4 (mutexes: write M507, write M603):
    #0 bitmap_is_set(st_bitmap const*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/../include/my_bitmap.h:141:10 (mysqld+0x00000076c4b5)
    #1 Field_string::val_str(String*, String*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/field.cc:6609:3 (mysqld+0x00000079c02e)
    #2 Field::val_str(String*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./field.h:121:48 (mysqld+0x0000005f4bc3)
    #3 get_field(st_mem_root*, Field*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:2614:3 (mysqld+0x0000009737d0)
    #4 handle_grant_table(TABLE_LIST*, unsigned int, bool, st_lex_user*, st_lex_user*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5251:22 (mysqld+0x000000ad1b69)
    #5 handle_grant_data(TABLE_LIST*, bool, st_lex_user*, st_lex_user*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5568:17 (mysqld+0x000000ac7bb8)
    #6 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5722:9 (mysqld+0x000000ac81a1)
    #7 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #8 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #9 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #10 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #11 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 4 at 0x7d60000033a0 by thread T5 (mutexes: write M467):
    #0 bitmap_is_set_all /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_bitmap.c:299:3 (mysqld+0x000000ff2121)
    #1 handler::ha_reset() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4571:3 (mysqld+0x000000bc94d6)
    #2 close_thread_table(THD*, st_table**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1403:5 (mysqld+0x00000092a595)
    #3 close_open_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1195:23 (mysqld+0x000000929e59)
    #4 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1347:5 (mysqld+0x00000092974f)
    #5 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1591:3 (mysqld+0x00000084b629)
    #6 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #7 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 992 at 0x7d6000003000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 alloc_root /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_alloc.c:201:30 (mysqld+0x000000fa2998)
    #3 open_binary_frm(THD*, st_table_share*, unsigned char*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:773:26 (mysqld+0x000000960ea5)
    #4 open_table_def(THD*, st_table_share*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:630:12 (mysqld+0x00000095f4b9)
    #5 get_table_share(THD*, TABLE_LIST*, char*, unsigned int, unsigned int, int*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:377:7 (mysqld+0x000000922803)
    #6 get_table_share_with_create(THD*, TABLE_LIST*, char*, unsigned int, unsigned int, int*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:456:10 (mysqld+0x0000009586d7)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3837:16 (mysqld+0x000000931268)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/../include/my_bitmap.h:141 bitmap_is_set(st_bitmap const*, unsigned int)
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x7d780000dbd0 by thread T6:
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97:8 (mysqld+0x0000010122b3)
    #1 thr_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:503:3 (mysqld+0x000001009b7f)
    #2 thr_multi_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:973:39 (mysqld+0x00000100e20f)
    #3 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:276:39 (mysqld+0x00000080ce67)
    #4 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #5 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #6 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #7 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #8 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x7d780000dbd0 by thread T4 (mutexes: write M670, write M669):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:166:3 (mysqld+0x0000010128c2)
    #1 thr_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:770:3 (mysqld+0x00000100c807)
    #2 thr_multi_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:1050:7 (mysqld+0x00000100f115)
    #3 mysql_unlock_tables(THD*, st_mysql_lock*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:389:5 (mysqld+0x00000080f801)
    #4 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1336:5 (mysqld+0x0000009296b3)
    #5 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5743:3 (mysqld+0x000000ac8351)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2672 at 0x7d780000d800 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3726:7 (mysqld+0x000000abcb48)
    #13 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #14 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #15 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M670 (0x7d780000dba8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3726:7 (mysqld+0x000000abcb48)
    #13 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #14 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #15 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M669 (0x7d780000db80) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:60:3 (mysqld+0x0000010120e7)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3726:7 (mysqld+0x000000abcb48)
    #13 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #14 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #15 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97 safe_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x7d80000053d0 by thread T5:
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97:8 (mysqld+0x0000010122b3)
    #1 thr_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:503:3 (mysqld+0x000001009b7f)
    #2 thr_multi_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:973:39 (mysqld+0x00000100e20f)
    #3 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:276:39 (mysqld+0x00000080ce67)
    #4 open_ltable(THD*, TABLE_LIST*, thr_lock_type, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4931:20 (mysqld+0x00000093ed37)
    #5 change_password(THD*, char const*, char const*, char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:1615:16 (mysqld+0x000000aa77ec)
    #6 set_var_password::update(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/set_var.cc:3671:10 (mysqld+0x000000891d9f)
    #7 sql_set_variables(THD*, List<set_var_base>*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/set_var.cc:3450:15 (mysqld+0x00000089057c)
    #8 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3450:16 (mysqld+0x00000085d223)
    #9 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #10 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #11 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #12 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x7d80000053d0 by thread T4 (mutexes: write M588, write M587):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:166:3 (mysqld+0x0000010128c2)
    #1 thr_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:770:3 (mysqld+0x00000100c807)
    #2 thr_multi_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:1050:7 (mysqld+0x00000100f115)
    #3 mysql_unlock_tables(THD*, st_mysql_lock*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:389:5 (mysqld+0x00000080f801)
    #4 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1336:5 (mysqld+0x0000009296b3)
    #5 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5743:3 (mysqld+0x000000ac8351)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 3792 at 0x7d8000005000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M588 (0x7d80000053a8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M587 (0x7d8000005380) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:60:3 (mysqld+0x0000010120e7)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97 safe_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 4 at 0x7d7c0000e34c by thread T6 (mutexes: write M507, write M603):
    #0 _mi_read_static_record /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_statrec.c:183:5 (mysqld+0x000000e84898)
    #1 _mi_read_rnd_static_record /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_statrec.c:266:16 (mysqld+0x000000e856c6)
    #2 mi_scan /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_scan.c:44:3 (mysqld+0x000000e81fa7)
    #3 ha_myisam::rnd_next(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1750:13 (mysqld+0x000000e339e0)
    #4 handle_grant_table(TABLE_LIST*, unsigned int, bool, st_lex_user*, st_lex_user*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5242:22 (mysqld+0x000000ad1a8b)
    #5 handle_grant_data(TABLE_LIST*, bool, st_lex_user*, st_lex_user*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5514:15 (mysqld+0x000000ac773e)
    #6 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5722:9 (mysqld+0x000000ac81a1)
    #7 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #8 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #9 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #10 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #11 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 4 at 0x7d7c0000e34c by thread T4 (mutexes: write M598):
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:233:7 (mysqld+0x000000e7ec3b)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 lock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:364:18 (mysqld+0x00000080f009)
    #4 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:260:34 (mysqld+0x00000080cb2d)
    #5 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #6 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #7 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #8 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #9 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #10 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #11 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #12 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #13 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #14 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 3232 at 0x7d7c0000e000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M598 (0x7d7c0000e488) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #12 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_statrec.c:183 _mi_read_static_record
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 1 at 0x7d600000a780 by thread T6 (mutexes: write M507, write M603):
    #0 bitmap_is_set(st_bitmap const*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/../include/my_bitmap.h:141:10 (mysqld+0x00000076c4b5)
    #1 Field_string::val_str(String*, String*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/field.cc:6609:3 (mysqld+0x00000079c02e)
    #2 Field::val_str(String*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./field.h:121:48 (mysqld+0x0000005f4bc3)
    #3 get_field(st_mem_root*, Field*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:2614:3 (mysqld+0x0000009737d0)
    #4 handle_grant_table(TABLE_LIST*, unsigned int, bool, st_lex_user*, st_lex_user*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5251:22 (mysqld+0x000000ad1b69)
    #5 handle_grant_data(TABLE_LIST*, bool, st_lex_user*, st_lex_user*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5514:15 (mysqld+0x000000ac773e)
    #6 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5722:9 (mysqld+0x000000ac81a1)
    #7 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #8 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #9 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #10 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #11 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 4 at 0x7d600000a780 by thread T4 (mutexes: write M467):
    #0 bitmap_is_set_all /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_bitmap.c:299:3 (mysqld+0x000000ff2121)
    #1 handler::ha_reset() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4571:3 (mysqld+0x000000bc94d6)
    #2 close_thread_table(THD*, st_table**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1403:5 (mysqld+0x00000092a595)
    #3 close_open_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1195:23 (mysqld+0x000000929e59)
    #4 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1347:5 (mysqld+0x00000092974f)
    #5 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5743:3 (mysqld+0x000000ac8351)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 992 at 0x7d600000a400 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 alloc_root /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_alloc.c:201:30 (mysqld+0x000000fa2998)
    #3 open_binary_frm(THD*, st_table_share*, unsigned char*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1050:2 (mysqld+0x0000009643ed)
    #4 open_table_def(THD*, st_table_share*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:630:12 (mysqld+0x00000095f4b9)
    #5 get_table_share(THD*, TABLE_LIST*, char*, unsigned int, unsigned int, int*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:377:7 (mysqld+0x000000922803)
    #6 get_table_share_with_create(THD*, TABLE_LIST*, char*, unsigned int, unsigned int, int*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:456:10 (mysqld+0x0000009586d7)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3837:16 (mysqld+0x000000931268)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/../include/my_bitmap.h:141 bitmap_is_set(st_bitmap const*, unsigned int)
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 8 at 0x00000229e2c8 by thread T4 (mutexes: write M662):
    #0 wait_for_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:408:3 (mysqld+0x00000100bd78)
    #1 thr_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:704:3 (mysqld+0x00000100b6de)
    #2 thr_multi_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:973:39 (mysqld+0x00000100e20f)
    #3 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:276:39 (mysqld+0x00000080ce67)
    #4 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #5 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #6 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #7 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #8 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x00000229e2c8 by thread T5 (mutexes: write M588):
    #0 wait_for_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:408:3 (mysqld+0x00000100bd78)
    #1 thr_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:704:3 (mysqld+0x00000100b6de)
    #2 thr_multi_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:973:39 (mysqld+0x00000100e20f)
    #3 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:276:39 (mysqld+0x00000080ce67)
    #4 open_ltable(THD*, TABLE_LIST*, thr_lock_type, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4931:20 (mysqld+0x00000093ed37)
    #5 change_password(THD*, char const*, char const*, char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:1615:16 (mysqld+0x000000aa77ec)
    #6 set_var_password::update(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/set_var.cc:3671:10 (mysqld+0x000000891d9f)
    #7 sql_set_variables(THD*, List<set_var_base>*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/set_var.cc:3450:15 (mysqld+0x00000089057c)
    #8 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3450:16 (mysqld+0x00000085d223)
    #9 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #10 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #11 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #12 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'locks_waited' of size 8 at 0x00000229e2c8 (mysqld+0x00000229e2c8)

  Mutex M662 (0x7d74000193a8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M588 (0x7d80000053a8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:408 wait_for_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 4 at 0x7d780000db4c by thread T6 (mutexes: write M507, write M603):
    #0 _mi_read_rnd_static_record /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_statrec.c:258:5 (mysqld+0x000000e854de)
    #1 mi_scan /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_scan.c:44:3 (mysqld+0x000000e81fa7)
    #2 ha_myisam::rnd_next(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1750:13 (mysqld+0x000000e339e0)
    #3 handle_grant_table(TABLE_LIST*, unsigned int, bool, st_lex_user*, st_lex_user*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5242:22 (mysqld+0x000000ad1a8b)
    #4 handle_grant_data(TABLE_LIST*, bool, st_lex_user*, st_lex_user*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5533:15 (mysqld+0x000000ac78e4)
    #5 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5722:9 (mysqld+0x000000ac81a1)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 4 at 0x7d780000db4c by thread T4 (mutexes: write M672):
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:233:7 (mysqld+0x000000e7ec3b)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 lock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:364:18 (mysqld+0x00000080f009)
    #4 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:260:34 (mysqld+0x00000080cb2d)
    #5 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #6 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #7 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #8 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #9 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #10 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #11 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #12 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #13 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #14 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2672 at 0x7d780000d800 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3726:7 (mysqld+0x000000abcb48)
    #13 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #14 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #15 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M672 (0x7d780000dc88) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3726:7 (mysqld+0x000000abcb48)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_statrec.c:258 _mi_read_rnd_static_record
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 8 at 0x00000229e2c0 by thread T6 (mutexes: write M670):
    #0 thr_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:681:4 (mysqld+0x00000100b4a8)
    #1 thr_multi_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:973:39 (mysqld+0x00000100e20f)
    #2 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:276:39 (mysqld+0x00000080ce67)
    #3 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #4 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #5 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #6 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #7 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #8 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #9 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #10 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #11 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #12 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x00000229e2c0 by thread T5 (mutexes: write M588):
    #0 thr_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:681:4 (mysqld+0x00000100b4a8)
    #1 thr_multi_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:973:39 (mysqld+0x00000100e20f)
    #2 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:276:39 (mysqld+0x00000080ce67)
    #3 open_ltable(THD*, TABLE_LIST*, thr_lock_type, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4931:20 (mysqld+0x00000093ed37)
    #4 change_password(THD*, char const*, char const*, char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:1615:16 (mysqld+0x000000aa77ec)
    #5 set_var_password::update(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/set_var.cc:3671:10 (mysqld+0x000000891d9f)
    #6 sql_set_variables(THD*, List<set_var_base>*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/set_var.cc:3450:15 (mysqld+0x00000089057c)
    #7 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3450:16 (mysqld+0x00000085d223)
    #8 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #9 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #10 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #11 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'locks_immediate' of size 8 at 0x00000229e2c0 (mysqld+0x00000229e2c0)

  Mutex M670 (0x7d780000dba8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3726:7 (mysqld+0x000000abcb48)
    #13 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #14 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #15 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M588 (0x7d80000053a8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:681 thr_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x7d740001d700 by thread T5 (mutexes: write M590):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97:8 (mysqld+0x0000010122b3)
    #1 flush_key_blocks /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mf_keycache.c:4012:3 (mysqld+0x000000f842ed)
    #2 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:64:31 (mysqld+0x000000e7cf89)
    #3 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #4 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #5 unlock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:786:20 (mysqld+0x00000080f565)
    #6 mysql_unlock_tables(THD*, st_mysql_lock*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:391:5 (mysqld+0x00000080f8b0)
    #7 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1336:5 (mysqld+0x0000009296b3)
    #8 change_password(THD*, char const*, char const*, char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:1654:3 (mysqld+0x000000aa7f07)
    #9 set_var_password::update(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/set_var.cc:3671:10 (mysqld+0x000000891d9f)
    #10 sql_set_variables(THD*, List<set_var_base>*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/set_var.cc:3450:15 (mysqld+0x00000089057c)
    #11 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3450:16 (mysqld+0x00000085d223)
    #12 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #13 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #14 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #15 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x7d740001d700 by thread T6 (mutexes: write M672, write M552, write M551):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:166:3 (mysqld+0x0000010128c2)
    #1 flush_key_blocks /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mf_keycache.c:4012:3 (mysqld+0x000000f842ed)
    #2 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:64:31 (mysqld+0x000000e7cf89)
    #3 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #4 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #5 unlock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:786:20 (mysqld+0x00000080f565)
    #6 mysql_unlock_tables(THD*, st_mysql_lock*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:391:5 (mysqld+0x00000080f8b0)
    #7 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1336:5 (mysqld+0x0000009296b3)
    #8 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5743:3 (mysqld+0x000000ac8351)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2440 at 0x7d740001d600 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 create_key_cache(char const*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/set_var.cc:4059:32 (mysqld+0x00000088a882)
    #3 get_or_create_key_cache(char const*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/set_var.cc:4093:16 (mysqld+0x000000894c76)
    #4 mysql_init_variables() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:7620:25 (mysqld+0x000000833f10)
    #5 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3174:7 (mysqld+0x000000825a45)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M590 (0x7d8000005488) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #12 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M672 (0x7d780000dc88) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3726:7 (mysqld+0x000000abcb48)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M552 (0x7d740001d6d8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_key_cache /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mf_keycache.c:402:5 (mysqld+0x000000f7606e)
    #3 ha_init_key_cache /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:3656:5 (mysqld+0x000000bc4bd1)
    #4 process_key_caches(int (*)(char const*, st_key_cache*)) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/set_var.cc:4114:5 (mysqld+0x000000894e6d)
    #5 init_server_components() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3875:3 (mysqld+0x000000829a02)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4354:7 (mysqld+0x0000008250b3)

  Mutex M551 (0x7d740001d6b0) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:60:3 (mysqld+0x0000010120e7)
    #2 init_key_cache /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mf_keycache.c:402:5 (mysqld+0x000000f7606e)
    #3 ha_init_key_cache /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:3656:5 (mysqld+0x000000bc4bd1)
    #4 process_key_caches(int (*)(char const*, st_key_cache*)) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/set_var.cc:4114:5 (mysqld+0x000000894e6d)
    #5 init_server_components() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3875:3 (mysqld+0x000000829a02)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4354:7 (mysqld+0x0000008250b3)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97 safe_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x7d7c0000e018 by thread T4 (mutexes: write M467):
    #0 mi_status /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_info.c:52:20 (mysqld+0x000000e56499)
    #1 ha_myisam::info(unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1779:10 (mysqld+0x000000e33e9c)
    #2 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:717:3 (mysqld+0x000000e29fc2)
    #3 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #4 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #5 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #6 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #7 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #8 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #9 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #10 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #11 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6762:31 (mysqld+0x000000851813)
    #12 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #13 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #14 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #15 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #16 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x7d7c0000e018 by thread T5 (mutexes: write M596):
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 mi_update_status /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:323:5 (mysqld+0x000000e7fc79)
    #2 thr_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:790:9 (mysqld+0x00000100cbd3)
    #3 thr_multi_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:1050:7 (mysqld+0x00000100f115)
    #4 mysql_unlock_tables(THD*, st_mysql_lock*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:389:5 (mysqld+0x00000080f801)
    #5 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1336:5 (mysqld+0x0000009296b3)
    #6 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5743:3 (mysqld+0x000000ac8351)
    #7 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #8 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #9 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #10 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #11 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 3232 at 0x7d7c0000e000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M596 (0x7d7c0000e3a8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_info.c:52 mi_status
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x7d7c0000e020 by thread T4 (mutexes: write M467):
    #0 mi_status /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_info.c:53:20 (mysqld+0x000000e56527)
    #1 ha_myisam::info(unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1779:10 (mysqld+0x000000e33e9c)
    #2 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:717:3 (mysqld+0x000000e29fc2)
    #3 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #4 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #5 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #6 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #7 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #8 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #9 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #10 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #11 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6762:31 (mysqld+0x000000851813)
    #12 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #13 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #14 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #15 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #16 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x7d7c0000e020 by thread T5 (mutexes: write M596):
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 mi_update_status /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:323:5 (mysqld+0x000000e7fc79)
    #2 thr_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:790:9 (mysqld+0x00000100cbd3)
    #3 thr_multi_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:1050:7 (mysqld+0x00000100f115)
    #4 mysql_unlock_tables(THD*, st_mysql_lock*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:389:5 (mysqld+0x00000080f801)
    #5 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1336:5 (mysqld+0x0000009296b3)
    #6 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5743:3 (mysqld+0x000000ac8351)
    #7 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #8 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #9 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #10 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #11 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 3232 at 0x7d7c0000e000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M596 (0x7d7c0000e3a8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_info.c:53 mi_status
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x7d7c0000e028 by thread T4 (mutexes: write M467):
    #0 mi_status /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_info.c:54:24 (mysqld+0x000000e565be)
    #1 ha_myisam::info(unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1779:10 (mysqld+0x000000e33e9c)
    #2 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:717:3 (mysqld+0x000000e29fc2)
    #3 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #4 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #5 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #6 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #7 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #8 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #9 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #10 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #11 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6762:31 (mysqld+0x000000851813)
    #12 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #13 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #14 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #15 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #16 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x7d7c0000e028 by thread T5 (mutexes: write M596):
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 mi_update_status /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:323:5 (mysqld+0x000000e7fc79)
    #2 thr_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:790:9 (mysqld+0x00000100cbd3)
    #3 thr_multi_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:1050:7 (mysqld+0x00000100f115)
    #4 mysql_unlock_tables(THD*, st_mysql_lock*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:389:5 (mysqld+0x00000080f801)
    #5 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1336:5 (mysqld+0x0000009296b3)
    #6 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5743:3 (mysqld+0x000000ac8351)
    #7 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #8 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #9 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #10 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #11 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 3232 at 0x7d7c0000e000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M596 (0x7d7c0000e3a8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_info.c:54 mi_status
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x7d7c0000e040 by thread T4 (mutexes: write M467):
    #0 mi_status /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_info.c:55:26 (mysqld+0x000000e56655)
    #1 ha_myisam::info(unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1779:10 (mysqld+0x000000e33e9c)
    #2 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:717:3 (mysqld+0x000000e29fc2)
    #3 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #4 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #5 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #6 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #7 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #8 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #9 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #10 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #11 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6762:31 (mysqld+0x000000851813)
    #12 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #13 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #14 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #15 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #16 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x7d7c0000e040 by thread T5 (mutexes: write M596):
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 mi_update_status /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:323:5 (mysqld+0x000000e7fc79)
    #2 thr_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:790:9 (mysqld+0x00000100cbd3)
    #3 thr_multi_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:1050:7 (mysqld+0x00000100f115)
    #4 mysql_unlock_tables(THD*, st_mysql_lock*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:389:5 (mysqld+0x00000080f801)
    #5 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1336:5 (mysqld+0x0000009296b3)
    #6 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5743:3 (mysqld+0x000000ac8351)
    #7 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #8 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #9 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #10 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #11 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 3232 at 0x7d7c0000e000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M596 (0x7d7c0000e3a8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_info.c:55 mi_status
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x7d7c0000e038 by thread T4 (mutexes: write M467):
    #0 mi_status /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_info.c:56:26 (mysqld+0x000000e566ec)
    #1 ha_myisam::info(unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1779:10 (mysqld+0x000000e33e9c)
    #2 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:717:3 (mysqld+0x000000e29fc2)
    #3 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #4 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #5 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #6 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #7 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #8 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #9 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #10 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #11 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6762:31 (mysqld+0x000000851813)
    #12 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #13 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #14 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #15 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #16 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x7d7c0000e038 by thread T5 (mutexes: write M596):
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 mi_update_status /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:323:5 (mysqld+0x000000e7fc79)
    #2 thr_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:790:9 (mysqld+0x00000100cbd3)
    #3 thr_multi_unlock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:1050:7 (mysqld+0x00000100f115)
    #4 mysql_unlock_tables(THD*, st_mysql_lock*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:389:5 (mysqld+0x00000080f801)
    #5 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1336:5 (mysqld+0x0000009296b3)
    #6 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5743:3 (mysqld+0x000000ac8351)
    #7 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #8 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #9 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #10 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #11 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 3232 at 0x7d7c0000e000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M596 (0x7d7c0000e3a8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_info.c:56 mi_status
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 1 at 0x7d700000cf74 by thread T4 (mutexes: write M603):
    #0 bitmap_is_set(st_bitmap const*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/../include/my_bitmap.h:141:10 (mysqld+0x00000076c4b5)
    #1 Field_blob::val_str(String*, String*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/field.cc:7821:3 (mysqld+0x0000007a869e)
    #2 Field::val_str(String*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./field.h:121:48 (mysqld+0x0000005f4bc3)
    #3 get_field(st_mem_root*, Field*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:2614:3 (mysqld+0x0000009737d0)
    #4 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:513:28 (mysqld+0x000000aa1fc0)
    #5 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #6 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6762:31 (mysqld+0x000000851813)
    #7 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #8 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #9 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #10 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #11 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 4 at 0x7d700000cf74 by thread T5 (mutexes: write M467):
    #0 bitmap_is_set_all /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_bitmap.c:299:3 (mysqld+0x000000ff2121)
    #1 handler::ha_reset() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4571:3 (mysqld+0x000000bc94d6)
    #2 close_thread_table(THD*, st_table**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1403:5 (mysqld+0x00000092a595)
    #3 close_open_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1195:23 (mysqld+0x000000929e59)
    #4 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1347:5 (mysqld+0x00000092974f)
    #5 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5743:3 (mysqld+0x000000ac8351)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 1984 at 0x7d700000c800 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 alloc_root /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_alloc.c:201:30 (mysqld+0x000000fa2998)
    #3 sql_alloc(unsigned long) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/thr_malloc.cc:65:10 (mysqld+0x0000006ffab4)
    #4 Field::operator new(unsigned long) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./field.h:54:12 (mysqld+0x0000005f2110)
    #5 make_field(st_table_share*, unsigned char*, unsigned int, unsigned char*, unsigned char, unsigned int, enum_field_types, charset_info_st*, Field::geometry_type, Field::utype, st_typelib*, char const*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/field.cc:10026:9 (mysqld+0x0000007bd082)
    #6 open_binary_frm(THD*, st_table_share*, unsigned char*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1268:7 (mysqld+0x0000009669fa)
    #7 open_table_def(THD*, st_table_share*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:630:12 (mysqld+0x00000095f4b9)
    #8 get_table_share(THD*, TABLE_LIST*, char*, unsigned int, unsigned int, int*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:377:7 (mysqld+0x000000922803)
    #9 get_table_share_with_create(THD*, TABLE_LIST*, char*, unsigned int, unsigned int, int*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:456:10 (mysqld+0x0000009586d7)
    #10 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3837:16 (mysqld+0x000000931268)
    #11 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #12 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #13 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #14 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #15 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #16 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #17 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/../include/my_bitmap.h:141 bitmap_is_set(st_bitmap const*, unsigned int)
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 4 at 0x7d8000005348 by thread T5:
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:34:3 (mysqld+0x000000e7c8df)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 lock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:364:18 (mysqld+0x00000080f009)
    #4 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:260:34 (mysqld+0x00000080cb2d)
    #5 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #6 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #7 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #8 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #9 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #10 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #11 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #12 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #13 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #14 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 4 at 0x7d8000005348 by thread T4 (mutexes: write M590):
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:182:7 (mysqld+0x000000e7e42e)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 lock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:364:18 (mysqld+0x00000080f009)
    #4 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:260:34 (mysqld+0x00000080cb2d)
    #5 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #6 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #7 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #8 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #9 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6762:31 (mysqld+0x000000851813)
    #10 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #11 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #12 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #13 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #14 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 3792 at 0x7d8000005000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M590 (0x7d8000005488) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #12 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:34 mi_lock_database
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x7d7c0000e3d0 by thread T5:
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97:8 (mysqld+0x0000010122b3)
    #1 thr_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:503:3 (mysqld+0x000001009b7f)
    #2 thr_multi_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:973:39 (mysqld+0x00000100e20f)
    #3 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:276:39 (mysqld+0x00000080ce67)
    #4 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #5 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #6 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #7 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #8 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x7d7c0000e3d0 by thread T4 (mutexes: write M596, write M595):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:166:3 (mysqld+0x0000010128c2)
    #1 thr_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:503:3 (mysqld+0x000001009b7f)
    #2 thr_multi_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:973:39 (mysqld+0x00000100e20f)
    #3 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:276:39 (mysqld+0x00000080ce67)
    #4 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #5 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #6 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #7 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #8 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6762:31 (mysqld+0x000000851813)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 3232 at 0x7d7c0000e000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M596 (0x7d7c0000e3a8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M595 (0x7d7c0000e380) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:60:3 (mysqld+0x0000010120e7)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97 safe_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 1 at 0x000002297638 by thread T4 (mutexes: write M603):
    #0 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:625:3 (mysqld+0x000000aa379d)
    #1 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #2 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6762:31 (mysqld+0x000000851813)
    #3 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #4 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #5 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #6 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #7 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 1 at 0x000002297638 by thread T6:
    #0 mysql_show_grants(THD*, st_lex_user*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:4504:8 (mysqld+0x000000ac16ad)
    #1 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3993:13 (mysqld+0x000000861e81)
    #2 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #3 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #4 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #5 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'initialized' of size 1 at 0x000002297638 (mysqld+0x000002297638)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:625 acl_load(THD*, TABLE_LIST*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 4 at 0x7d780000db48 by thread T5:
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:34:3 (mysqld+0x000000e7c8df)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 unlock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:786:20 (mysqld+0x00000080f565)
    #4 mysql_unlock_tables(THD*, st_mysql_lock*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:391:5 (mysqld+0x00000080f8b0)
    #5 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1336:5 (mysqld+0x0000009296b3)
    #6 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5743:3 (mysqld+0x000000ac8351)
    #7 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #8 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #9 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #10 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #11 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 4 at 0x7d780000db48 by thread T4 (mutexes: write M672):
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:59:9 (mysqld+0x000000e7cd81)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 unlock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:786:20 (mysqld+0x00000080f565)
    #4 mysql_unlock_tables(THD*, st_mysql_lock*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:391:5 (mysqld+0x00000080f8b0)
    #5 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1336:5 (mysqld+0x0000009296b3)
    #6 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3752:3 (mysqld+0x000000abcd2c)
    #7 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #8 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2672 at 0x7d780000d800 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3726:7 (mysqld+0x000000abcb48)
    #13 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #14 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #15 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M672 (0x7d780000dc88) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3726:7 (mysqld+0x000000abcb48)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:34 mi_lock_database
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x7d780000f4b0 by thread T5 (mutexes: write M467, write M438):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97:8 (mysqld+0x0000010122b3)
    #1 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:614:3 (mysqld+0x000000e3e8f3)
    #2 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #3 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #4 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #5 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #6 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #7 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #8 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #9 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #10 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #11 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6762:31 (mysqld+0x000000851813)
    #12 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #13 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #14 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #15 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #16 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x7d780000f4b0 by thread T4 (mutexes: write M582, write M581):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:166:3 (mysqld+0x0000010128c2)
    #1 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:52:3 (mysqld+0x000000e7cc61)
    #2 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #3 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #4 lock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:364:18 (mysqld+0x00000080f009)
    #5 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:260:34 (mysqld+0x00000080cb2d)
    #6 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #7 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #8 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #9 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #10 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6762:31 (mysqld+0x000000851813)
    #11 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #12 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #13 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #14 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #15 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2864 at 0x7d780000f000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M438 (0x00000229fdd8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 my_thread_global_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_thr_init.c:145:3 (mysqld+0x00000101443a)
    #3 my_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_init.c:81:7 (mysqld+0x000000f6fb5f)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4215:3 (mysqld+0x000000824ba3)

  Mutex M582 (0x7d780000f488) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #12 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M581 (0x7d780000f460) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:60:3 (mysqld+0x0000010120e7)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #12 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97 safe_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 4 at 0x7d780000f354 by thread T5 (mutexes: write M467, write M438, write M582):
    #0 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:617:3 (mysqld+0x000000e3e9da)
    #1 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #2 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #3 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #4 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #5 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #6 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #7 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #8 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #9 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #10 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6762:31 (mysqld+0x000000851813)
    #11 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #12 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #13 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #14 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #15 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 4 at 0x7d780000f354 by thread T4 (mutexes: write M603):
    #0 mi_extra /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_extra.c:105:6 (mysqld+0x000000e53404)
    #1 ha_myisam::extra_opt(ha_extra_function, unsigned long) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1862:10 (mysqld+0x000000e34e19)
    #2 init_read_record(st_read_record*, THD*, st_table*, SQL_SELECT*, int, bool, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/records.cc:261:7 (mysqld+0x000000b9def4)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:327:3 (mysqld+0x000000aa023e)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6762:31 (mysqld+0x000000851813)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2864 at 0x7d780000f000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M467 (0x00000228f890) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3506:10 (mysqld+0x000000832bf4)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M438 (0x00000229fdd8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 my_thread_global_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_thr_init.c:145:3 (mysqld+0x00000101443a)
    #3 my_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_init.c:81:7 (mysqld+0x000000f6fb5f)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4215:3 (mysqld+0x000000824ba3)

  Mutex M582 (0x7d780000f488) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #12 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:617 mi_open
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 4 at 0x7d780000f34c by thread T5 (mutexes: write M582):
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:183:7 (mysqld+0x000000e7e478)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 lock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:364:18 (mysqld+0x00000080f009)
    #4 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:260:34 (mysqld+0x00000080cb2d)
    #5 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #6 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #7 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #8 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #9 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6762:31 (mysqld+0x000000851813)
    #10 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #11 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #12 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #13 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #14 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 4 at 0x7d780000f34c by thread T4 (mutexes: write M603):
    #0 _mi_read_rnd_static_record /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_statrec.c:258:5 (mysqld+0x000000e854de)
    #1 mi_scan /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_scan.c:44:3 (mysqld+0x000000e81fa7)
    #2 ha_myisam::rnd_next(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1750:13 (mysqld+0x000000e339e0)
    #3 rr_sequential(st_read_record*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/records.cc:381:15 (mysqld+0x000000ba1472)
    #4 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:331:12 (mysqld+0x000000aa02a0)
    #5 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #6 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6762:31 (mysqld+0x000000851813)
    #7 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #8 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #9 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #10 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #11 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2864 at 0x7d780000f000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M582 (0x7d780000f488) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #12 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:183 mi_lock_database
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x7d780000f3d0 by thread T5:
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97:8 (mysqld+0x0000010122b3)
    #1 thr_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:503:3 (mysqld+0x000001009b7f)
    #2 thr_multi_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:973:39 (mysqld+0x00000100e20f)
    #3 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:276:39 (mysqld+0x00000080ce67)
    #4 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #5 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #6 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #7 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #8 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6762:31 (mysqld+0x000000851813)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x7d780000f3d0 by thread T4 (mutexes: write M580, write M579):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:166:3 (mysqld+0x0000010128c2)
    #1 thr_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:503:3 (mysqld+0x000001009b7f)
    #2 thr_multi_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:973:39 (mysqld+0x00000100e20f)
    #3 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:276:39 (mysqld+0x00000080ce67)
    #4 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #5 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #6 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #7 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #8 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6762:31 (mysqld+0x000000851813)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2864 at 0x7d780000f000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M580 (0x7d780000f3a8) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M579 (0x7d780000f380) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:60:3 (mysqld+0x0000010120e7)
    #2 thr_lock_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_lock.c:319:3 (mysqld+0x00000100935a)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:524:5 (mysqld+0x000000e3d917)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:702:7 (mysqld+0x000000a9fa91)
    #13 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97 safe_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 4 at 0x000002297678 by thread T4 (mutexes: write M507):
    #0 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3831:3 (mysqld+0x000000abbf03)
    #1 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #2 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #3 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #4 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #5 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #6 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 4 at 0x000002297678 by thread T5 (mutexes: write M603):
    #0 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:322:3 (mysqld+0x000000aa0161)
    #1 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #2 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6762:31 (mysqld+0x000000851813)
    #3 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #4 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #5 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #6 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #7 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'grant_version' of size 4 at 0x000002297678 (mysqld+0x000002297678)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3831 grant_reload(THD*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x7d7400019068 by thread T5 (mutexes: write M507, read M665):
    #0 _mi_test_if_changed /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:484:7 (mysqld+0x000000e7ed8f)
    #1 mi_rnext /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_rnext.c:43:11 (mysqld+0x000000e59628)
    #2 ha_myisam::index_next(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1692:13 (mysqld+0x000000e330cd)
    #3 GRANT_TABLE::GRANT_TABLE(st_table*, st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2386:15 (mysqld+0x000000aac27a)
    #4 grant_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3659:23 (mysqld+0x000000abc495)
    #5 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3808:20 (mysqld+0x000000abbd97)
    #6 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #7 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #8 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #9 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #10 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #11 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x7d7400019068 by thread T4 (mutexes: write M664):
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:98:4 (mysqld+0x000000e7d748)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 unlock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:786:20 (mysqld+0x00000080f565)
    #4 mysql_unlock_tables(THD*, st_mysql_lock*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:391:5 (mysqld+0x00000080f8b0)
    #5 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1336:5 (mysqld+0x0000009296b3)
    #6 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5743:3 (mysqld+0x000000ac8351)
    #7 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #8 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #9 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #10 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #11 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2400 at 0x7d7400019000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M665 (0x7d74000198f0) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:527:7 (mysqld+0x000000e3da09)
    #2 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #3 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #4 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #5 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #6 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #7 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #8 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #9 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #10 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #11 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #12 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M664 (0x7d7400019488) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #12 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:484 _mi_test_if_changed
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x7d74000192f8 by thread T5 (mutexes: write M507, read M665):
    #0 _mi_test_if_changed /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:484:31 (mysqld+0x000000e7edc1)
    #1 mi_rnext /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_rnext.c:43:11 (mysqld+0x000000e59628)
    #2 ha_myisam::index_next(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1692:13 (mysqld+0x000000e330cd)
    #3 GRANT_TABLE::GRANT_TABLE(st_table*, st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2386:15 (mysqld+0x000000aac27a)
    #4 grant_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3659:23 (mysqld+0x000000abc495)
    #5 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3808:20 (mysqld+0x000000abbd97)
    #6 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #7 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #8 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #9 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #10 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #11 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x7d74000192f8 by thread T4 (mutexes: write M664):
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:98:26 (mysqld+0x000000e7d70a)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 unlock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:786:20 (mysqld+0x00000080f565)
    #4 mysql_unlock_tables(THD*, st_mysql_lock*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:391:5 (mysqld+0x00000080f8b0)
    #5 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1336:5 (mysqld+0x0000009296b3)
    #6 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5743:3 (mysqld+0x000000ac8351)
    #7 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #8 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #9 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #10 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #11 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2400 at 0x7d7400019000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M665 (0x7d74000198f0) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:527:7 (mysqld+0x000000e3da09)
    #2 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #3 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #4 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #5 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #6 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #7 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #8 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #9 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #10 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #11 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #12 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M664 (0x7d7400019488) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #12 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:484 _mi_test_if_changed
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x7d7400019070 by thread T5 (mutexes: write M507, read M665):
    #0 _mi_test_if_changed /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:485:7 (mysqld+0x000000e7edf9)
    #1 mi_rnext /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_rnext.c:43:11 (mysqld+0x000000e59628)
    #2 ha_myisam::index_next(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1692:13 (mysqld+0x000000e330cd)
    #3 GRANT_TABLE::GRANT_TABLE(st_table*, st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2386:15 (mysqld+0x000000aac27a)
    #4 grant_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3659:23 (mysqld+0x000000abc495)
    #5 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3808:20 (mysqld+0x000000abbd97)
    #6 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #7 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #8 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #9 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #10 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #11 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x7d7400019070 by thread T4 (mutexes: write M664):
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:99:4 (mysqld+0x000000e7d7ff)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 unlock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:786:20 (mysqld+0x00000080f565)
    #4 mysql_unlock_tables(THD*, st_mysql_lock*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:391:5 (mysqld+0x00000080f8b0)
    #5 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1336:5 (mysqld+0x0000009296b3)
    #6 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5743:3 (mysqld+0x000000ac8351)
    #7 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #8 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #9 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #10 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #11 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2400 at 0x7d7400019000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M665 (0x7d74000198f0) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:527:7 (mysqld+0x000000e3da09)
    #2 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #3 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #4 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #5 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #6 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #7 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #8 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #9 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #10 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #11 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #12 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M664 (0x7d7400019488) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #12 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:485 _mi_test_if_changed
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x7d7400019078 by thread T5 (mutexes: write M507, read M665):
    #0 _mi_test_if_changed /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:493:22 (mysqld+0x000000e7f0e7)
    #1 mi_rnext /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_rnext.c:43:11 (mysqld+0x000000e59628)
    #2 ha_myisam::index_next(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1692:13 (mysqld+0x000000e330cd)
    #3 GRANT_TABLE::GRANT_TABLE(st_table*, st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2386:15 (mysqld+0x000000aac27a)
    #4 grant_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3659:23 (mysqld+0x000000abc495)
    #5 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3808:20 (mysqld+0x000000abbd97)
    #6 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #7 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #8 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #9 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #10 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #11 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x7d7400019078 by thread T4 (mutexes: write M664):
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:100:4 (mysqld+0x000000e7d8cb)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 unlock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:786:20 (mysqld+0x00000080f565)
    #4 mysql_unlock_tables(THD*, st_mysql_lock*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:391:5 (mysqld+0x00000080f8b0)
    #5 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1336:5 (mysqld+0x0000009296b3)
    #6 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5743:3 (mysqld+0x000000ac8351)
    #7 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #8 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #9 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #10 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #11 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2400 at 0x7d7400019000 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M665 (0x7d74000198f0) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:527:7 (mysqld+0x000000e3da09)
    #2 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #3 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #4 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #5 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #6 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #7 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #8 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #9 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #10 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #11 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #12 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M664 (0x7d7400019488) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #12 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:493 _mi_test_if_changed
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x7d780000e6f8 by thread T4 (mutexes: write M655):
    #0 _mi_test_if_changed /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:484:31 (mysqld+0x000000e7edc1)
    #1 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:228:7 (mysqld+0x000000e7eace)
    #2 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #3 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #4 lock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:364:18 (mysqld+0x00000080f009)
    #5 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:260:34 (mysqld+0x00000080cb2d)
    #6 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #7 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #8 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #9 open_grant_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5048:7 (mysqld+0x000000ac6852)
    #10 mysql_drop_user(THD*, List<st_lex_user>&) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:5709:16 (mysqld+0x000000ac7fdf)
    #11 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3796:16 (mysqld+0x0000008600fb)
    #12 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #13 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #14 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #15 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x7d780000e6f8 by thread T5 (mutexes: write M507, read M656):
    #0 _mi_test_if_changed /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:491:5 (mysqld+0x000000e7f030)
    #1 mi_rnext /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_rnext.c:43:11 (mysqld+0x000000e59628)
    #2 ha_myisam::index_next(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1692:13 (mysqld+0x000000e330cd)
    #3 grant_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3687:13 (mysqld+0x000000abc88c)
    #4 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3808:20 (mysqld+0x000000abbd97)
    #5 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2632 at 0x7d780000e400 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M655 (0x7d780000e888) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #12 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M656 (0x7d780000eda0) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:527:7 (mysqld+0x000000e3da09)
    #2 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #3 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #4 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #5 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #6 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #7 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #8 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #9 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #10 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #11 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #12 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Thread T4 (tid=11710, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:484 _mi_test_if_changed
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 4 at 0x00000228d868 by thread T5:
    #0 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6740:3 (mysqld+0x0000008515f5)
    #1 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #2 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #3 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #4 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #5 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 4 at 0x00000228d868 by thread T6:
    #0 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6740:3 (mysqld+0x0000008515f5)
    #1 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #2 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #3 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #4 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #5 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'select_errors' of size 4 at 0x00000228d868 (mysqld+0x00000228d868)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6740 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 4 at 0x7d780000e748 by thread T5:
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:34:3 (mysqld+0x000000e7c8df)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 lock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:364:18 (mysqld+0x00000080f009)
    #4 mysql_lock_tables(THD*, st_table**, unsigned int, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:260:34 (mysqld+0x00000080cb2d)
    #5 lock_tables(THD*, TABLE_LIST*, unsigned int, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:5287:23 (mysqld+0x00000093fd41)
    #6 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4985:10 (mysqld+0x00000093f3c6)
    #7 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #8 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #9 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #10 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #11 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #12 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #13 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #14 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 4 at 0x7d780000e748 by thread T6 (mutexes: write M655):
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:59:9 (mysqld+0x000000e7cd81)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 unlock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:786:20 (mysqld+0x00000080f565)
    #4 mysql_unlock_tables(THD*, st_mysql_lock*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:391:5 (mysqld+0x00000080f8b0)
    #5 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1336:5 (mysqld+0x0000009296b3)
    #6 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3821:3 (mysqld+0x000000abbe9f)
    #7 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #8 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #9 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #10 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #11 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #12 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2632 at 0x7d780000e400 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M655 (0x7d780000e888) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #12 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:34 mi_lock_database
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 1 at 0x7d780000e75d by thread T6 (mutexes: write M507, write M603):
    #0 _mi_writeinfo /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:473:5 (mysqld+0x000000e80ebf)
    #1 mi_write /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_write.c:158:3 (mysqld+0x000000eb1383)
    #2 ha_myisam::write_row(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:772:10 (mysqld+0x000000e2a97c)
    #3 handler::ha_write_row(unsigned char*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4591:7 (mysqld+0x000000bc9747)
    #4 replace_table_table(THD*, GRANT_TABLE*, st_table*, st_lex_user const&, char const*, char const*, unsigned long, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2769:11 (mysqld+0x000000ab3ea6)
    #5 mysql_table_grant(THD*, TABLE_LIST*, List<st_lex_user>&, List<LEX_COLUMN>&, unsigned long, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3157:9 (mysqld+0x000000aae2a8)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3894:14 (mysqld+0x000000861408)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 1 at 0x7d780000e75d by thread T5 (mutexes: write M655):
    #0 mi_lock_database /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:82:2 (mysqld+0x000000e7d2c3)
    #1 ha_myisam::external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:1878:10 (mysqld+0x000000e35065)
    #2 handler::ha_external_lock(THD*, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:4554:14 (mysqld+0x000000bc9244)
    #3 unlock_external(THD*, st_table**, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:786:20 (mysqld+0x00000080f565)
    #4 mysql_unlock_tables(THD*, st_mysql_lock*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/lock.cc:391:5 (mysqld+0x00000080f8b0)
    #5 close_thread_tables(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:1336:5 (mysqld+0x0000009296b3)
    #6 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3821:3 (mysqld+0x000000abbe9f)
    #7 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #8 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #9 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #10 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #11 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #12 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is heap block of size 2632 at 0x7d780000e400 allocated by main thread:
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 my_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/my_malloc.c:34:23 (mysqld+0x000000f9f816)
    #2 my_multi_malloc /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/mulalloc.c:50:24 (mysqld+0x000000fa12e5)
    #3 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:294:10 (mysqld+0x000000e3a358)
    #4 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #5 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #6 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #7 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #8 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #9 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #10 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #11 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #12 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #13 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #14 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M603 (0x7d4000007568) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 hash_filo::clear(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./hash_filo.h:75:14 (mysqld+0x00000083c05d)
    #3 acl_load(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:324:3 (mysqld+0x000000aa0192)
    #4 acl_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:719:20 (mysqld+0x000000a9fc67)
    #5 acl_init(bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:286:15 (mysqld+0x000000a9f371)
    #6 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4382:32 (mysqld+0x000000825172)

  Mutex M655 (0x7d780000e888) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 mi_open /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_open.c:525:5 (mysqld+0x000000e3d954)
    #3 ha_myisam::open(char const*, int, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/ha_myisam.cc:690:14 (mysqld+0x000000e29a90)
    #4 handler::ha_open(st_table*, char const*, int, int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/handler.cc:2047:14 (mysqld+0x000000bbbfd8)
    #5 open_table_from_share(THD*, st_table_share*, char const*, unsigned int, unsigned int, unsigned int, st_table*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/table.cc:1873:19 (mysqld+0x00000096d098)
    #6 open_unireg_entry(THD*, st_table*, TABLE_LIST*, char const*, char*, unsigned int, st_mem_root*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:3903:18 (mysqld+0x000000931863)
    #7 open_table(THD*, TABLE_LIST*, st_mem_root*, bool*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:2906:12 (mysqld+0x000000935ceb)
    #8 open_tables(THD*, TABLE_LIST**, unsigned int*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4570:24 (mysqld+0x00000093bbb5)
    #9 open_and_lock_tables_derived(THD*, TABLE_LIST*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_base.cc:4976:9 (mysqld+0x00000093f22e)
    #10 simple_open_n_lock_tables(THD*, TABLE_LIST*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/./mysql_priv.h:1550:10 (mysqld+0x00000087c622)
    #11 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3795:7 (mysqld+0x000000abbcd6)
    #12 grant_init() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3510:16 (mysqld+0x000000abb8b4)
    #13 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4399:12 (mysqld+0x0000008252ca)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/storage/myisam/mi_locking.c:473 _mi_writeinfo
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 8 at 0x0000022976f0 by thread T5 (mutexes: write M507):
    #0 _my_hash_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:57:3 (mysqld+0x000000fcaf53)
    #1 grant_load_procs_priv(st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3541:10 (mysqld+0x000000ad3680)
    #2 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3737:20 (mysqld+0x000000abcc2c)
    #3 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #4 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #5 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #6 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #7 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #8 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #9 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x0000022976f0 by thread T6:
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3733:3 (mysqld+0x000000abcbb9)
    #2 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #3 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #4 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #5 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'proc_priv_hash' of size 88 at 0x0000022976d8 (mysqld+0x0000022976f0)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:57 _my_hash_init
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 4 at 0x000002297708 by thread T5 (mutexes: write M507):
    #0 init_dynamic_array2 /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/array.c:60:3 (mysqld+0x000000fd0dd2)
    #1 _my_hash_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:58:7 (mysqld+0x000000fcafc3)
    #2 grant_load_procs_priv(st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3541:10 (mysqld+0x000000ad3680)
    #3 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3737:20 (mysqld+0x000000abcc2c)
    #4 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #5 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x000002297708 by thread T6:
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3733:3 (mysqld+0x000000abcbb9)
    #2 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #3 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #4 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #5 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'proc_priv_hash' of size 88 at 0x0000022976d8 (mysqld+0x000002297708)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/array.c:60 init_dynamic_array2
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 4 at 0x000002297710 by thread T5 (mutexes: write M507):
    #0 init_dynamic_array2 /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/array.c:62:3 (mysqld+0x000000fd0e66)
    #1 _my_hash_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:58:7 (mysqld+0x000000fcafc3)
    #2 grant_load_procs_priv(st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3541:10 (mysqld+0x000000ad3680)
    #3 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3737:20 (mysqld+0x000000abcc2c)
    #4 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #5 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x000002297710 by thread T6:
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3733:3 (mysqld+0x000000abcbb9)
    #2 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #3 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #4 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #5 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'proc_priv_hash' of size 88 at 0x0000022976d8 (mysqld+0x000002297710)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/array.c:62 init_dynamic_array2
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 8 at 0x000002297700 by thread T5 (mutexes: write M507):
    #0 init_dynamic_array2 /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/array.c:64:8 (mysqld+0x000000fd0ef7)
    #1 _my_hash_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:58:7 (mysqld+0x000000fcafc3)
    #2 grant_load_procs_priv(st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3541:10 (mysqld+0x000000ad3680)
    #3 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3737:20 (mysqld+0x000000abcc2c)
    #4 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #5 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x000002297700 by thread T6:
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3733:3 (mysqld+0x000000abcbb9)
    #2 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #3 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #4 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #5 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'proc_priv_hash' of size 88 at 0x0000022976d8 (mysqld+0x000002297700)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/array.c:64 init_dynamic_array2
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 8 at 0x0000022976d8 by thread T5 (mutexes: write M507):
    #0 _my_hash_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:64:3 (mysqld+0x000000fcb05e)
    #1 grant_load_procs_priv(st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3541:10 (mysqld+0x000000ad3680)
    #2 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3737:20 (mysqld+0x000000abcc2c)
    #3 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #4 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #5 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #6 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #7 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #8 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #9 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x0000022976d8 by thread T6:
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3733:3 (mysqld+0x000000abcbb9)
    #2 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #3 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #4 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #5 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'proc_priv_hash' of size 88 at 0x0000022976d8 (mysqld+0x0000022976d8)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:64 _my_hash_init
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 8 at 0x0000022976e0 by thread T5 (mutexes: write M507):
    #0 _my_hash_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:65:3 (mysqld+0x000000fcb0af)
    #1 grant_load_procs_priv(st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3541:10 (mysqld+0x000000ad3680)
    #2 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3737:20 (mysqld+0x000000abcc2c)
    #3 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #4 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #5 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #6 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #7 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #8 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #9 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x0000022976e0 by thread T6:
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3733:3 (mysqld+0x000000abcbb9)
    #2 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #3 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #4 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #5 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'proc_priv_hash' of size 88 at 0x0000022976d8 (mysqld+0x0000022976e0)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:65 _my_hash_init
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 8 at 0x0000022976e8 by thread T5 (mutexes: write M507):
    #0 _my_hash_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:66:3 (mysqld+0x000000fcb0ea)
    #1 grant_load_procs_priv(st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3541:10 (mysqld+0x000000ad3680)
    #2 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3737:20 (mysqld+0x000000abcc2c)
    #3 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #4 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #5 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #6 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #7 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #8 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #9 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x0000022976e8 by thread T6:
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3733:3 (mysqld+0x000000abcbb9)
    #2 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #3 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #4 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #5 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'proc_priv_hash' of size 88 at 0x0000022976d8 (mysqld+0x0000022976e8)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:66 _my_hash_init
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 8 at 0x000002297718 by thread T5 (mutexes: write M507):
    #0 _my_hash_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:67:3 (mysqld+0x000000fcb139)
    #1 grant_load_procs_priv(st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3541:10 (mysqld+0x000000ad3680)
    #2 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3737:20 (mysqld+0x000000abcc2c)
    #3 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #4 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #5 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #6 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #7 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #8 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #9 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x000002297718 by thread T6:
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3733:3 (mysqld+0x000000abcbb9)
    #2 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #3 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #4 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #5 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'proc_priv_hash' of size 88 at 0x0000022976d8 (mysqld+0x000002297718)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:67 _my_hash_init
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 8 at 0x000002297720 by thread T5 (mutexes: write M507):
    #0 _my_hash_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:68:3 (mysqld+0x000000fcb18b)
    #1 grant_load_procs_priv(st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3541:10 (mysqld+0x000000ad3680)
    #2 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3737:20 (mysqld+0x000000abcc2c)
    #3 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #4 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #5 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #6 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #7 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #8 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #9 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x000002297720 by thread T6:
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3733:3 (mysqld+0x000000abcbb9)
    #2 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #3 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #4 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #5 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'proc_priv_hash' of size 88 at 0x0000022976d8 (mysqld+0x000002297720)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:68 _my_hash_init
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 4 at 0x0000022976f8 by thread T5 (mutexes: write M507):
    #0 _my_hash_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:69:3 (mysqld+0x000000fcb1db)
    #1 grant_load_procs_priv(st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3541:10 (mysqld+0x000000ad3680)
    #2 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3737:20 (mysqld+0x000000abcc2c)
    #3 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #4 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #5 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #6 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #7 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #8 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #9 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x0000022976f8 by thread T6:
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3733:3 (mysqld+0x000000abcbb9)
    #2 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #3 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #4 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #5 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'proc_priv_hash' of size 88 at 0x0000022976d8 (mysqld+0x0000022976f8)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:69 _my_hash_init
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 8 at 0x000002297728 by thread T5 (mutexes: write M507):
    #0 _my_hash_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:70:3 (mysqld+0x000000fcb22b)
    #1 grant_load_procs_priv(st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3541:10 (mysqld+0x000000ad3680)
    #2 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3737:20 (mysqld+0x000000abcc2c)
    #3 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #4 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #5 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #6 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #7 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #8 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #9 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x000002297728 by thread T6:
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3733:3 (mysqld+0x000000abcbb9)
    #2 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #3 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #4 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #5 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'proc_priv_hash' of size 88 at 0x0000022976d8 (mysqld+0x000002297728)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:70 _my_hash_init
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 8 at 0x000002297748 by thread T5 (mutexes: write M507):
    #0 _my_hash_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:57:3 (mysqld+0x000000fcaf53)
    #1 grant_load_procs_priv(st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3544:10 (mysqld+0x000000ad36f3)
    #2 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3737:20 (mysqld+0x000000abcc2c)
    #3 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #4 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #5 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #6 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #7 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #8 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #9 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x000002297748 by thread T6:
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3734:3 (mysqld+0x000000abcbee)
    #2 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #3 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #4 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #5 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'func_priv_hash' of size 88 at 0x000002297730 (mysqld+0x000002297748)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:57 _my_hash_init
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 4 at 0x000002297760 by thread T5 (mutexes: write M507):
    #0 init_dynamic_array2 /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/array.c:60:3 (mysqld+0x000000fd0dd2)
    #1 _my_hash_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:58:7 (mysqld+0x000000fcafc3)
    #2 grant_load_procs_priv(st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3544:10 (mysqld+0x000000ad36f3)
    #3 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3737:20 (mysqld+0x000000abcc2c)
    #4 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #5 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x000002297760 by thread T6:
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3734:3 (mysqld+0x000000abcbee)
    #2 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #3 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #4 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #5 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'func_priv_hash' of size 88 at 0x000002297730 (mysqld+0x000002297760)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/array.c:60 init_dynamic_array2
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 4 at 0x000002297768 by thread T5 (mutexes: write M507):
    #0 init_dynamic_array2 /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/array.c:62:3 (mysqld+0x000000fd0e66)
    #1 _my_hash_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:58:7 (mysqld+0x000000fcafc3)
    #2 grant_load_procs_priv(st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3544:10 (mysqld+0x000000ad36f3)
    #3 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3737:20 (mysqld+0x000000abcc2c)
    #4 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #5 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x000002297768 by thread T6:
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3734:3 (mysqld+0x000000abcbee)
    #2 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #3 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #4 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #5 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'func_priv_hash' of size 88 at 0x000002297730 (mysqld+0x000002297768)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/array.c:62 init_dynamic_array2
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 8 at 0x000002297758 by thread T5 (mutexes: write M507):
    #0 init_dynamic_array2 /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/array.c:64:8 (mysqld+0x000000fd0ef7)
    #1 _my_hash_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:58:7 (mysqld+0x000000fcafc3)
    #2 grant_load_procs_priv(st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3544:10 (mysqld+0x000000ad36f3)
    #3 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3737:20 (mysqld+0x000000abcc2c)
    #4 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #5 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #6 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #7 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #8 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #9 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #10 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x000002297758 by thread T6:
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3734:3 (mysqld+0x000000abcbee)
    #2 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #3 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #4 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #5 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'func_priv_hash' of size 88 at 0x000002297730 (mysqld+0x000002297758)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/array.c:64 init_dynamic_array2
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 8 at 0x000002297730 by thread T5 (mutexes: write M507):
    #0 _my_hash_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:64:3 (mysqld+0x000000fcb05e)
    #1 grant_load_procs_priv(st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3544:10 (mysqld+0x000000ad36f3)
    #2 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3737:20 (mysqld+0x000000abcc2c)
    #3 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #4 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #5 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #6 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #7 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #8 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #9 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x000002297730 by thread T6:
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3734:3 (mysqld+0x000000abcbee)
    #2 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #3 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #4 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #5 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'func_priv_hash' of size 88 at 0x000002297730 (mysqld+0x000002297730)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:64 _my_hash_init
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 8 at 0x000002297738 by thread T5 (mutexes: write M507):
    #0 _my_hash_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:65:3 (mysqld+0x000000fcb0af)
    #1 grant_load_procs_priv(st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3544:10 (mysqld+0x000000ad36f3)
    #2 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3737:20 (mysqld+0x000000abcc2c)
    #3 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #4 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #5 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #6 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #7 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #8 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #9 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x000002297738 by thread T6:
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3734:3 (mysqld+0x000000abcbee)
    #2 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #3 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #4 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #5 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'func_priv_hash' of size 88 at 0x000002297730 (mysqld+0x000002297738)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:65 _my_hash_init
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 8 at 0x000002297740 by thread T5 (mutexes: write M507):
    #0 _my_hash_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:66:3 (mysqld+0x000000fcb0ea)
    #1 grant_load_procs_priv(st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3544:10 (mysqld+0x000000ad36f3)
    #2 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3737:20 (mysqld+0x000000abcc2c)
    #3 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #4 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #5 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #6 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #7 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #8 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #9 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x000002297740 by thread T6:
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3734:3 (mysqld+0x000000abcbee)
    #2 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #3 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #4 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #5 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'func_priv_hash' of size 88 at 0x000002297730 (mysqld+0x000002297740)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:66 _my_hash_init
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 8 at 0x000002297770 by thread T5 (mutexes: write M507):
    #0 _my_hash_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:67:3 (mysqld+0x000000fcb139)
    #1 grant_load_procs_priv(st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3544:10 (mysqld+0x000000ad36f3)
    #2 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3737:20 (mysqld+0x000000abcc2c)
    #3 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #4 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #5 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #6 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #7 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #8 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #9 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x000002297770 by thread T6:
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3734:3 (mysqld+0x000000abcbee)
    #2 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #3 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #4 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #5 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'func_priv_hash' of size 88 at 0x000002297730 (mysqld+0x000002297770)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:67 _my_hash_init
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 8 at 0x000002297778 by thread T5 (mutexes: write M507):
    #0 _my_hash_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:68:3 (mysqld+0x000000fcb18b)
    #1 grant_load_procs_priv(st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3544:10 (mysqld+0x000000ad36f3)
    #2 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3737:20 (mysqld+0x000000abcc2c)
    #3 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #4 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #5 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #6 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #7 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #8 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #9 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x000002297778 by thread T6:
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3734:3 (mysqld+0x000000abcbee)
    #2 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #3 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #4 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #5 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'func_priv_hash' of size 88 at 0x000002297730 (mysqld+0x000002297778)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:68 _my_hash_init
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 4 at 0x000002297750 by thread T5 (mutexes: write M507):
    #0 _my_hash_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:69:3 (mysqld+0x000000fcb1db)
    #1 grant_load_procs_priv(st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3544:10 (mysqld+0x000000ad36f3)
    #2 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3737:20 (mysqld+0x000000abcc2c)
    #3 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #4 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #5 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #6 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #7 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #8 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #9 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x000002297750 by thread T6:
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3734:3 (mysqld+0x000000abcbee)
    #2 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #3 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #4 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #5 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'func_priv_hash' of size 88 at 0x000002297730 (mysqld+0x000002297750)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:69 _my_hash_init
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Write of size 8 at 0x000002297780 by thread T5 (mutexes: write M507):
    #0 _my_hash_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:70:3 (mysqld+0x000000fcb22b)
    #1 grant_load_procs_priv(st_table*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3544:10 (mysqld+0x000000ad36f3)
    #2 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3737:20 (mysqld+0x000000abcc2c)
    #3 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #4 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #5 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #6 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #7 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #8 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #9 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous read of size 8 at 0x000002297780 by thread T6:
    #0 memcpy /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:638 (mysqld+0x000000530c56)
    #1 grant_reload_procs_priv(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3734:3 (mysqld+0x000000abcbee)
    #2 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3827:7 (mysqld+0x000000abbeb1)
    #3 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #4 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #5 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #6 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #7 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #8 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'func_priv_hash' of size 88 at 0x000002297730 (mysqld+0x000002297780)

  Mutex M507 (0x000002290020) created at:
    #0 pthread_rwlock_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1169 (mysqld+0x000000520bf3)
    #1 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3542:10 (mysqld+0x000000832f46)
    #2 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #3 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:70 _my_hash_init
==================
==================
WARNING: ThreadSanitizer: data race (pid=11692)
  Read of size 8 at 0x00000228fe68 by thread T5:
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97:8 (mysqld+0x0000010122b3)
    #1 reset_mqh(st_lex_user*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:538:10 (mysqld+0x00000083fffd)
    #2 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6784:5 (mysqld+0x0000008519ac)
    #3 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #4 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #5 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #6 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #7 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Previous write of size 8 at 0x00000228fe68 by thread T6 (mutexes: write M491, write M490):
    #0 safe_mutex_lock /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:166:3 (mysqld+0x0000010128c2)
    #1 reset_mqh(st_lex_user*, bool) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:538:10 (mysqld+0x00000083fffd)
    #2 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6784:5 (mysqld+0x0000008519ac)
    #3 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #4 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #5 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #6 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #7 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

  Location is global 'LOCK_user_conn' of size 104 at 0x00000228fe18 (mysqld+0x00000228fe68)

  Mutex M491 (0x00000228fe40) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:61:3 (mysqld+0x00000101211e)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3518:10 (mysqld+0x000000832dec)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Mutex M490 (0x00000228fe18) created at:
    #0 pthread_mutex_init /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1082 (mysqld+0x00000052deb5)
    #1 safe_mutex_init /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:60:3 (mysqld+0x0000010120e7)
    #2 init_thread_environment() /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3518:10 (mysqld+0x000000832dec)
    #3 init_common_variables(char const*, int, char**, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:3173:7 (mysqld+0x000000825a35)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4255:7 (mysqld+0x000000824c3c)

  Thread T5 (tid=11712, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

  Thread T6 (tid=11713, running) created by main thread at:
    #0 pthread_create /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:896 (mysqld+0x0000005410d3)
    #1 create_thread_to_handle_connection(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4809:16 (mysqld+0x00000082cee3)
    #2 create_new_thread(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4901:3 (mysqld+0x00000082d6b0)
    #3 handle_connections_sockets /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:5132:5 (mysqld+0x00000082cae4)
    #4 main /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:4470:3 (mysqld+0x00000082564c)

SUMMARY: ThreadSanitizer: data race /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/thr_mutex.c:97 safe_mutex_lock
==================
==================
WARNING: ThreadSanitizer: signal-unsafe call inside of a signal (pid=11692)
    #0 malloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:495 (mysqld+0x0000005386ef)
    #1 __backtrace_symbols <null> (libc.so.6+0x00000010b054)
    #2 my_print_stacktrace /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/stacktrace.c:115:17 (mysqld+0x000001004c31)
    #3 handle_segfault /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:2464:5 (mysqld+0x0000008232fc)
    #4 __tsan::CallUserSignalHandler(__tsan::ThreadState*, bool, bool, bool, int, my_siginfo_t*, void*) /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1895 (mysqld+0x00000051a7d8)
    #5 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #6 free_grant_table(GRANT_TABLE*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2409:3 (mysqld+0x000000aac4a9)
    #7 my_hash_free_elements /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:93:9 (mysqld+0x000000fcb562)
    #8 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #9 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3817:5 (mysqld+0x000000abbe6a)
    #10 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #11 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #12 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #13 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #14 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #15 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

SUMMARY: ThreadSanitizer: signal-unsafe call inside of a signal ??:0 __backtrace_symbols
==================
==================
WARNING: ThreadSanitizer: signal-unsafe call inside of a signal (pid=11692)
    #0 realloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:525 (mysqld+0x00000053a95e)
    #1 <null> <null> (libstdc++.so.6+0x000000060fcb)
    #2 my_demangle_symbols /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/stacktrace.c:89:18 (mysqld+0x000001004f80)
    #3 my_print_stacktrace /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/stacktrace.c:117:5 (mysqld+0x000001004c9f)
    #4 handle_segfault /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:2464:5 (mysqld+0x0000008232fc)
    #5 __tsan::CallUserSignalHandler(__tsan::ThreadState*, bool, bool, bool, int, my_siginfo_t*, void*) /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1895 (mysqld+0x00000051a7d8)
    #6 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #7 free_grant_table(GRANT_TABLE*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2409:3 (mysqld+0x000000aac4a9)
    #8 my_hash_free_elements /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:93:9 (mysqld+0x000000fcb562)
    #9 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #10 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3817:5 (mysqld+0x000000abbe6a)
    #11 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #12 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #13 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #14 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #15 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #16 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

SUMMARY: ThreadSanitizer: signal-unsafe call inside of a signal ??:0 ??
==================
==================
WARNING: ThreadSanitizer: signal-unsafe call inside of a signal (pid=11692)
    #0 realloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:525 (mysqld+0x00000053a95e)
    #1 <null> <null> (libstdc++.so.6+0x000000060fcb)
    #2 my_demangle_symbols /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/stacktrace.c:89:18 (mysqld+0x000001004f80)
    #3 my_print_stacktrace /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/stacktrace.c:117:5 (mysqld+0x000001004c9f)
    #4 handle_segfault /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:2464:5 (mysqld+0x0000008232fc)
    #5 __tsan::CallUserSignalHandler(__tsan::ThreadState*, bool, bool, bool, int, my_siginfo_t*, void*) /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1895 (mysqld+0x00000051a7d8)
    #6 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #7 free_grant_table(GRANT_TABLE*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2409:3 (mysqld+0x000000aac4a9)
    #8 my_hash_free_elements /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:93:9 (mysqld+0x000000fcb562)
    #9 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #10 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3817:5 (mysqld+0x000000abbe6a)
    #11 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #12 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #13 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #14 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #15 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #16 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

SUMMARY: ThreadSanitizer: signal-unsafe call inside of a signal ??:0 ??
==================
==================
WARNING: ThreadSanitizer: signal-unsafe call inside of a signal (pid=11692)
    #0 realloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:525 (mysqld+0x00000053a95e)
    #1 <null> <null> (libstdc++.so.6+0x000000060fcb)
    #2 my_demangle_symbols /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/stacktrace.c:89:18 (mysqld+0x000001004f80)
    #3 my_print_stacktrace /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/stacktrace.c:117:5 (mysqld+0x000001004c9f)
    #4 handle_segfault /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:2464:5 (mysqld+0x0000008232fc)
    #5 __tsan::CallUserSignalHandler(__tsan::ThreadState*, bool, bool, bool, int, my_siginfo_t*, void*) /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1895 (mysqld+0x00000051a7d8)
    #6 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #7 free_grant_table(GRANT_TABLE*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2409:3 (mysqld+0x000000aac4a9)
    #8 my_hash_free_elements /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:93:9 (mysqld+0x000000fcb562)
    #9 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #10 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3817:5 (mysqld+0x000000abbe6a)
    #11 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #12 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #13 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #14 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #15 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #16 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

SUMMARY: ThreadSanitizer: signal-unsafe call inside of a signal ??:0 ??
==================
==================
WARNING: ThreadSanitizer: signal-unsafe call inside of a signal (pid=11692)
    #0 realloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:525 (mysqld+0x00000053a95e)
    #1 <null> <null> (libstdc++.so.6+0x000000060fcb)
    #2 my_demangle_symbols /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/stacktrace.c:89:18 (mysqld+0x000001004f80)
    #3 my_print_stacktrace /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/stacktrace.c:117:5 (mysqld+0x000001004c9f)
    #4 handle_segfault /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:2464:5 (mysqld+0x0000008232fc)
    #5 __tsan::CallUserSignalHandler(__tsan::ThreadState*, bool, bool, bool, int, my_siginfo_t*, void*) /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1895 (mysqld+0x00000051a7d8)
    #6 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #7 free_grant_table(GRANT_TABLE*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2409:3 (mysqld+0x000000aac4a9)
    #8 my_hash_free_elements /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:93:9 (mysqld+0x000000fcb562)
    #9 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #10 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3817:5 (mysqld+0x000000abbe6a)
    #11 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #12 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #13 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #14 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #15 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #16 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

SUMMARY: ThreadSanitizer: signal-unsafe call inside of a signal ??:0 ??
==================
==================
WARNING: ThreadSanitizer: signal-unsafe call inside of a signal (pid=11692)
    #0 realloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:525 (mysqld+0x00000053a95e)
    #1 <null> <null> (libstdc++.so.6+0x000000060fcb)
    #2 my_demangle_symbols /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/stacktrace.c:89:18 (mysqld+0x000001004f80)
    #3 my_print_stacktrace /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/stacktrace.c:117:5 (mysqld+0x000001004c9f)
    #4 handle_segfault /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:2464:5 (mysqld+0x0000008232fc)
    #5 __tsan::CallUserSignalHandler(__tsan::ThreadState*, bool, bool, bool, int, my_siginfo_t*, void*) /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1895 (mysqld+0x00000051a7d8)
    #6 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #7 free_grant_table(GRANT_TABLE*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2409:3 (mysqld+0x000000aac4a9)
    #8 my_hash_free_elements /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:93:9 (mysqld+0x000000fcb562)
    #9 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #10 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3817:5 (mysqld+0x000000abbe6a)
    #11 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #12 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #13 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #14 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #15 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #16 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

SUMMARY: ThreadSanitizer: signal-unsafe call inside of a signal ??:0 ??
==================
==================
WARNING: ThreadSanitizer: signal-unsafe call inside of a signal (pid=11692)
    #0 realloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:525 (mysqld+0x00000053a95e)
    #1 <null> <null> (libstdc++.so.6+0x000000060fcb)
    #2 my_demangle_symbols /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/stacktrace.c:89:18 (mysqld+0x000001004f80)
    #3 my_print_stacktrace /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/stacktrace.c:117:5 (mysqld+0x000001004c9f)
    #4 handle_segfault /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:2464:5 (mysqld+0x0000008232fc)
    #5 __tsan::CallUserSignalHandler(__tsan::ThreadState*, bool, bool, bool, int, my_siginfo_t*, void*) /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1895 (mysqld+0x00000051a7d8)
    #6 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #7 free_grant_table(GRANT_TABLE*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2409:3 (mysqld+0x000000aac4a9)
    #8 my_hash_free_elements /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:93:9 (mysqld+0x000000fcb562)
    #9 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #10 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3817:5 (mysqld+0x000000abbe6a)
    #11 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #12 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #13 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #14 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #15 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #16 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

SUMMARY: ThreadSanitizer: signal-unsafe call inside of a signal ??:0 ??
==================
==================
WARNING: ThreadSanitizer: signal-unsafe call inside of a signal (pid=11692)
    #0 realloc /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:525 (mysqld+0x00000053a95e)
    #1 <null> <null> (libstdc++.so.6+0x000000060fcb)
    #2 my_demangle_symbols /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/stacktrace.c:89:18 (mysqld+0x000001004f80)
    #3 my_print_stacktrace /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/stacktrace.c:117:5 (mysqld+0x000001004c9f)
    #4 handle_segfault /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:2464:5 (mysqld+0x0000008232fc)
    #5 __tsan::CallUserSignalHandler(__tsan::ThreadState*, bool, bool, bool, int, my_siginfo_t*, void*) /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1895 (mysqld+0x00000051a7d8)
    #6 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #7 free_grant_table(GRANT_TABLE*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2409:3 (mysqld+0x000000aac4a9)
    #8 my_hash_free_elements /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:93:9 (mysqld+0x000000fcb562)
    #9 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #10 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3817:5 (mysqld+0x000000abbe6a)
    #11 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #12 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #13 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #14 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #15 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #16 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

SUMMARY: ThreadSanitizer: signal-unsafe call inside of a signal ??:0 ??
==================
==================
WARNING: ThreadSanitizer: signal-unsafe call inside of a signal (pid=11692)
    #0 free /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:538 (mysqld+0x00000053ccf6)
    #1 my_print_stacktrace /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/stacktrace.c:118:5 (mysqld+0x000001004cbd)
    #2 handle_segfault /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/mysqld.cc:2464:5 (mysqld+0x0000008232fc)
    #3 __tsan::CallUserSignalHandler(__tsan::ThreadState*, bool, bool, bool, int, my_siginfo_t*, void*) /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1895 (mysqld+0x00000051a7d8)
    #4 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #5 free_grant_table(GRANT_TABLE*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2409:3 (mysqld+0x000000aac4a9)
    #6 my_hash_free_elements /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:93:9 (mysqld+0x000000fcb562)
    #7 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #8 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3817:5 (mysqld+0x000000abbe6a)
    #9 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #10 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #11 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #12 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #13 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #14 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

SUMMARY: ThreadSanitizer: signal-unsafe call inside of a signal /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/stacktrace.c:118 my_print_stacktrace
==================
==================
WARNING: ThreadSanitizer: signal-unsafe call inside of a signal (pid=11692)
    #0 free /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:538 (mysqld+0x00000053ccf6)
    #1 <null> <null> (libc.so.6+0x00000003c27f)
    #2 __tsan::CallUserSignalHandler(__tsan::ThreadState*, bool, bool, bool, int, my_siginfo_t*, void*) /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1895 (mysqld+0x00000051a7d8)
    #3 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #4 free_grant_table(GRANT_TABLE*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2409:3 (mysqld+0x000000aac4a9)
    #5 my_hash_free_elements /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:93:9 (mysqld+0x000000fcb562)
    #6 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #7 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3817:5 (mysqld+0x000000abbe6a)
    #8 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

SUMMARY: ThreadSanitizer: signal-unsafe call inside of a signal ??:0 ??
==================
==================
WARNING: ThreadSanitizer: signal-unsafe call inside of a signal (pid=11692)
    #0 free /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:538 (mysqld+0x00000053ccf6)
    #1 <null> <null> (libc.so.6+0x00000003c27f)
    #2 __tsan::CallUserSignalHandler(__tsan::ThreadState*, bool, bool, bool, int, my_siginfo_t*, void*) /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1895 (mysqld+0x00000051a7d8)
    #3 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #4 free_grant_table(GRANT_TABLE*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2409:3 (mysqld+0x000000aac4a9)
    #5 my_hash_free_elements /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:93:9 (mysqld+0x000000fcb562)
    #6 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #7 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3817:5 (mysqld+0x000000abbe6a)
    #8 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

SUMMARY: ThreadSanitizer: signal-unsafe call inside of a signal ??:0 ??
==================
==================
WARNING: ThreadSanitizer: signal-unsafe call inside of a signal (pid=11692)
    #0 free /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:538 (mysqld+0x00000053ccf6)
    #1 <null> <null> (libc.so.6+0x00000003c27f)
    #2 __tsan::CallUserSignalHandler(__tsan::ThreadState*, bool, bool, bool, int, my_siginfo_t*, void*) /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1895 (mysqld+0x00000051a7d8)
    #3 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #4 free_grant_table(GRANT_TABLE*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2409:3 (mysqld+0x000000aac4a9)
    #5 my_hash_free_elements /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:93:9 (mysqld+0x000000fcb562)
    #6 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #7 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3817:5 (mysqld+0x000000abbe6a)
    #8 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

SUMMARY: ThreadSanitizer: signal-unsafe call inside of a signal ??:0 ??
==================
==================
WARNING: ThreadSanitizer: signal-unsafe call inside of a signal (pid=11692)
    #0 free /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:538 (mysqld+0x00000053ccf6)
    #1 <null> <null> (libc.so.6+0x00000003c27f)
    #2 __tsan::CallUserSignalHandler(__tsan::ThreadState*, bool, bool, bool, int, my_siginfo_t*, void*) /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1895 (mysqld+0x00000051a7d8)
    #3 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #4 free_grant_table(GRANT_TABLE*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2409:3 (mysqld+0x000000aac4a9)
    #5 my_hash_free_elements /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:93:9 (mysqld+0x000000fcb562)
    #6 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #7 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3817:5 (mysqld+0x000000abbe6a)
    #8 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

SUMMARY: ThreadSanitizer: signal-unsafe call inside of a signal ??:0 ??
==================
==================
WARNING: ThreadSanitizer: signal-unsafe call inside of a signal (pid=11692)
    #0 free /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:538 (mysqld+0x00000053ccf6)
    #1 <null> <null> (libc.so.6+0x00000003c27f)
    #2 __tsan::CallUserSignalHandler(__tsan::ThreadState*, bool, bool, bool, int, my_siginfo_t*, void*) /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1895 (mysqld+0x00000051a7d8)
    #3 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #4 free_grant_table(GRANT_TABLE*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2409:3 (mysqld+0x000000aac4a9)
    #5 my_hash_free_elements /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:93:9 (mysqld+0x000000fcb562)
    #6 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #7 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3817:5 (mysqld+0x000000abbe6a)
    #8 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

SUMMARY: ThreadSanitizer: signal-unsafe call inside of a signal ??:0 ??
==================
==================
WARNING: ThreadSanitizer: signal-unsafe call inside of a signal (pid=11692)
    #0 free /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:538 (mysqld+0x00000053ccf6)
    #1 <null> <null> (libc.so.6+0x00000003c27f)
    #2 __tsan::CallUserSignalHandler(__tsan::ThreadState*, bool, bool, bool, int, my_siginfo_t*, void*) /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1895 (mysqld+0x00000051a7d8)
    #3 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #4 free_grant_table(GRANT_TABLE*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2409:3 (mysqld+0x000000aac4a9)
    #5 my_hash_free_elements /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:93:9 (mysqld+0x000000fcb562)
    #6 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #7 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3817:5 (mysqld+0x000000abbe6a)
    #8 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

SUMMARY: ThreadSanitizer: signal-unsafe call inside of a signal ??:0 ??
==================
==================
WARNING: ThreadSanitizer: signal-unsafe call inside of a signal (pid=11692)
    #0 free /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:538 (mysqld+0x00000053ccf6)
    #1 <null> <null> (libc.so.6+0x00000003c27f)
    #2 __tsan::CallUserSignalHandler(__tsan::ThreadState*, bool, bool, bool, int, my_siginfo_t*, void*) /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1895 (mysqld+0x00000051a7d8)
    #3 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #4 free_grant_table(GRANT_TABLE*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2409:3 (mysqld+0x000000aac4a9)
    #5 my_hash_free_elements /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:93:9 (mysqld+0x000000fcb562)
    #6 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #7 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3817:5 (mysqld+0x000000abbe6a)
    #8 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

SUMMARY: ThreadSanitizer: signal-unsafe call inside of a signal ??:0 ??
==================
==================
WARNING: ThreadSanitizer: signal-unsafe call inside of a signal (pid=11692)
    #0 free /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:538 (mysqld+0x00000053ccf6)
    #1 <null> <null> (libc.so.6+0x00000003c27f)
    #2 __tsan::CallUserSignalHandler(__tsan::ThreadState*, bool, bool, bool, int, my_siginfo_t*, void*) /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1895 (mysqld+0x00000051a7d8)
    #3 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #4 free_grant_table(GRANT_TABLE*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2409:3 (mysqld+0x000000aac4a9)
    #5 my_hash_free_elements /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:93:9 (mysqld+0x000000fcb562)
    #6 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #7 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3817:5 (mysqld+0x000000abbe6a)
    #8 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

SUMMARY: ThreadSanitizer: signal-unsafe call inside of a signal ??:0 ??
==================
==================
WARNING: ThreadSanitizer: signal-unsafe call inside of a signal (pid=11692)
    #0 free /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:538 (mysqld+0x00000053ccf6)
    #1 <null> <null> (libc.so.6+0x00000003c27f)
    #2 __tsan::CallUserSignalHandler(__tsan::ThreadState*, bool, bool, bool, int, my_siginfo_t*, void*) /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1895 (mysqld+0x00000051a7d8)
    #3 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #4 free_grant_table(GRANT_TABLE*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2409:3 (mysqld+0x000000aac4a9)
    #5 my_hash_free_elements /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:93:9 (mysqld+0x000000fcb562)
    #6 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #7 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3817:5 (mysqld+0x000000abbe6a)
    #8 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

SUMMARY: ThreadSanitizer: signal-unsafe call inside of a signal ??:0 ??
==================
==================
WARNING: ThreadSanitizer: signal-unsafe call inside of a signal (pid=11692)
    #0 free /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:538 (mysqld+0x00000053ccf6)
    #1 <null> <null> (libc.so.6+0x00000003c27f)
    #2 __tsan::CallUserSignalHandler(__tsan::ThreadState*, bool, bool, bool, int, my_siginfo_t*, void*) /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1895 (mysqld+0x00000051a7d8)
    #3 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #4 free_grant_table(GRANT_TABLE*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2409:3 (mysqld+0x000000aac4a9)
    #5 my_hash_free_elements /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:93:9 (mysqld+0x000000fcb562)
    #6 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #7 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3817:5 (mysqld+0x000000abbe6a)
    #8 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

SUMMARY: ThreadSanitizer: signal-unsafe call inside of a signal ??:0 ??
==================
==================
WARNING: ThreadSanitizer: signal-unsafe call inside of a signal (pid=11692)
    #0 free /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:538 (mysqld+0x00000053ccf6)
    #1 <null> <null> (libc.so.6+0x00000003c27f)
    #2 __tsan::CallUserSignalHandler(__tsan::ThreadState*, bool, bool, bool, int, my_siginfo_t*, void*) /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1895 (mysqld+0x00000051a7d8)
    #3 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #4 free_grant_table(GRANT_TABLE*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2409:3 (mysqld+0x000000aac4a9)
    #5 my_hash_free_elements /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:93:9 (mysqld+0x000000fcb562)
    #6 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #7 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3817:5 (mysqld+0x000000abbe6a)
    #8 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

SUMMARY: ThreadSanitizer: signal-unsafe call inside of a signal ??:0 ??
==================
==================
WARNING: ThreadSanitizer: signal-unsafe call inside of a signal (pid=11692)
    #0 free /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:538 (mysqld+0x00000053ccf6)
    #1 <null> <null> (libc.so.6+0x00000003c27f)
    #2 __tsan::CallUserSignalHandler(__tsan::ThreadState*, bool, bool, bool, int, my_siginfo_t*, void*) /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1895 (mysqld+0x00000051a7d8)
    #3 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #4 free_grant_table(GRANT_TABLE*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2409:3 (mysqld+0x000000aac4a9)
    #5 my_hash_free_elements /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:93:9 (mysqld+0x000000fcb562)
    #6 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #7 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3817:5 (mysqld+0x000000abbe6a)
    #8 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

SUMMARY: ThreadSanitizer: signal-unsafe call inside of a signal ??:0 ??
==================
==================
WARNING: ThreadSanitizer: signal-unsafe call inside of a signal (pid=11692)
    #0 free /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:538 (mysqld+0x00000053ccf6)
    #1 <null> <null> (libc.so.6+0x00000003c27f)
    #2 __tsan::CallUserSignalHandler(__tsan::ThreadState*, bool, bool, bool, int, my_siginfo_t*, void*) /home/ruigu/Workspace/llvm-3.6.1.src/projects/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:1895 (mysqld+0x00000051a7d8)
    #3 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #4 free_grant_table(GRANT_TABLE*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:2409:3 (mysqld+0x000000aac4a9)
    #5 my_hash_free_elements /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:93:9 (mysqld+0x000000fcb562)
    #6 my_hash_free /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/mysys/hash.c:114:3 (mysqld+0x000000fcb337)
    #7 grant_reload(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_acl.cc:3817:5 (mysqld+0x000000abbe6a)
    #8 reload_acl_and_cache(THD*, unsigned long, TABLE_LIST*, bool*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:6763:34 (mysqld+0x000000851844)
    #9 mysql_execute_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:3945:10 (mysqld+0x00000086186e)
    #10 mysql_parse(THD*, char const*, unsigned int, char const**) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:5929:11 (mysqld+0x00000084d00d)
    #11 dispatch_command(enum_server_command, THD*, char*, unsigned int) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:1216:5 (mysqld+0x000000848b28)
    #12 do_command(THD*) /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_parse.cc:857:17 (mysqld+0x00000084e3e0)
    #13 handle_one_connection /home/ruigu/Workspace/concurrency-exploits/mysql-35589/mysql-5.1.35/sql/sql_connect.cc:1115:11 (mysqld+0x000000841058)

SUMMARY: ThreadSanitizer: signal-unsafe call inside of a signal ??:0 ??
==================
ThreadSanitizer: reported 115 warnings
